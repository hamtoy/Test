<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™¸ë¶€ ë‹µë³€ í‰ê°€ - Gemini QA System</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <h1>ğŸ¤– Gemini QA System</h1>
        <nav>
            <a href="/qa">QA ìƒì„±</a>
            <a href="/eval" class="active">ì™¸ë¶€ í‰ê°€</a>
            <a href="/workspace">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</a>
            <a href="/multimodal">ì´ë¯¸ì§€ ë¶„ì„</a>
        </nav>
    </header>

    <main>
        <section class="card">
            <h2>ì™¸ë¶€ ë‹µë³€ í‰ê°€</h2>
            <p>3ê°œì˜ ë‹µë³€ì„ ì…ë ¥í•˜ë©´ OCR í…ìŠ¤íŠ¸ì™€ ì§ˆì˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤.</p>
            <form id="eval-form">
                <div class="form-group">
                    <label for="query">ì§ˆì˜</label>
                    <textarea id="query" name="query" rows="2" required></textarea>
                </div>

                <div class="form-group">
                    <label for="answer-a">ë‹µë³€ A</label>
                    <textarea id="answer-a" name="answer_a" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label for="answer-b">ë‹µë³€ B</label>
                    <textarea id="answer-b" name="answer_b" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label for="answer-c">ë‹µë³€ C</label>
                    <textarea id="answer-c" name="answer_c" rows="3" required></textarea>
                </div>

                <button type="submit">í‰ê°€í•˜ê¸°</button>
            </form>
        </section>

        <section class="card" id="result-section" style="display:none;">
            <h2>í‰ê°€ ê²°ê³¼</h2>
            <div id="result"></div>
        </section>
    </main>

    <script>
        document.getElementById('eval-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const query = document.getElementById('query').value;
            const answers = [
                document.getElementById('answer-a').value,
                document.getElementById('answer-b').value,
                document.getElementById('answer-c').value
            ];

            try {
                const res = await fetch('/api/eval/external', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, answers })
                });

                const data = await res.json();

                const resultSection = document.getElementById('result-section');
                const resultDiv = document.getElementById('result');

                if (res.ok) {
                    let html = `<p><strong>ìµœê³  ë‹µë³€:</strong> ${data.best}</p>`;
                    html += '<table><tr><th>ë‹µë³€</th><th>ì ìˆ˜</th><th>í”¼ë“œë°±</th></tr>';
                    data.results.forEach(r => {
                        const isBest = r.candidate_id === data.best ? 'class="best"' : '';
                        html += `<tr ${isBest}>
                            <td>${r.candidate_id}</td>
                            <td>${r.score}</td>
                            <td>${r.feedback}</td>
                        </tr>`;
                    });
                    html += '</table>';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<p class="error">${data.detail || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</p>`;
                }

                resultSection.style.display = 'block';
            } catch (err) {
                console.error(err);
                alert('ìš”ì²­ ì‹¤íŒ¨: ' + err.message);
            }
        });
    </script>
</body>
</html>
{% extends "layout.html" %}

{% block content %}
<div class="split-layout">
    <!-- ì™¼ìª½: OCR ì˜ì—­ -->
    <div class="left-panel">
        <h2>ğŸ“„ OCR í…ìŠ¤íŠ¸</h2>
        <div id="ocr-preview" class="ocr-box">ë¡œë”© ì¤‘...</div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: í‰ê°€ ì…ë ¥ -->
    <div class="right-panel">
        <h2>ğŸ“Š ì™¸ë¶€ ë‹µë³€ í‰ê°€</h2>
        
        <div class="form-group">
            <label>ì§ˆì˜</label>
            <input type="text" id="query" placeholder="ì§ˆì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-group">
            <label>ë‹µë³€ A</label>
            <textarea id="answer-a" rows="4"></textarea>
        </div>

        <div class="form-group">
            <label>ë‹µë³€ B</label>
            <textarea id="answer-b" rows="4"></textarea>
        </div>

        <div class="form-group">
            <label>ë‹µë³€ C</label>
            <textarea id="answer-c" rows="4"></textarea>
        </div>

        <button id="eval-btn" class="btn-primary">âš–ï¸ í‰ê°€ ì‹¤í–‰</button>

        <div id="eval-results" class="results-area"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    loadOCR();

    document.getElementById('eval-btn').addEventListener('click', async () => {
        const query = document.getElementById('query').value;
        const answers = [
            document.getElementById('answer-a').value,
            document.getElementById('answer-b').value,
            document.getElementById('answer-c').value,
        ];

        if (!query || answers.some(a => !a.trim())) {
            alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        await evaluateAnswers(query, answers);
    });
</script>
{% endblock %}
