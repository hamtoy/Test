import{d as x,s as v,c as h,e as B}from"../app.js";import{l as b,s as I}from"./ocr.js";import{validateRequest as q,ValidationError as C}from"./validation.js";const g="workspace_global_explanation",u={current:"full",switchTo(e){this.current=e;const t=document.getElementById("query"),r=document.getElementById("answer"),o=document.getElementById("query-badge"),a=document.getElementById("answer-badge"),n=document.getElementById("query-help"),s=document.getElementById("answer-help"),i=document.getElementById("query-type-section"),l=document.getElementById("execute-btn");t.readOnly=!1,r.readOnly=!1,t.classList.remove("output-only","required-input"),r.classList.remove("output-only","required-input"),e==="full"?(o.textContent="ì„ íƒ",o.className="field-badge optional",a.textContent="ì„ íƒ",a.className="field-badge optional",n.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",s.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",t.placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",r.placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",i.style.display="block",l.textContent="ğŸš€ ì‹¤í–‰"):e==="query-only"?(o.textContent="ìë™ ìƒì„±",o.className="field-badge output",a.textContent="í•„ìˆ˜ ì…ë ¥",a.className="field-badge required",n.innerHTML="ğŸ¤– <strong>ë‹µë³€ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",s.innerHTML="âœ… <strong>ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ì§ˆë¬¸ ìƒì„±)",t.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì§ˆë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤",r.placeholder="ì§ˆë¬¸ì„ ìƒì„±í•  ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”",t.readOnly=!0,t.classList.add("output-only"),r.classList.add("required-input"),i.style.display="none",l.textContent="â“ ì§ˆë¬¸ ìƒì„±"):e==="answer-only"&&(o.textContent="í•„ìˆ˜ ì…ë ¥",o.className="field-badge required",a.textContent="ìë™ ìƒì„±",a.className="field-badge output",n.innerHTML="âœ… <strong>ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ë‹µë³€ ìƒì„±)",s.innerHTML="ğŸ¤– <strong>ì§ˆë¬¸ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",t.placeholder="ë‹µë³€ì„ ìƒì„±í•  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",r.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ë‹µë³€ì´ í‘œì‹œë©ë‹ˆë‹¤",r.readOnly=!0,r.classList.add("output-only"),t.classList.add("required-input"),i.style.display="block",l.textContent="ğŸ’¡ ë‹µë³€ ìƒì„±"),this.updateValidation()},updateValidation(){const e=document.getElementById("query").value.trim(),t=document.getElementById("answer").value.trim(),r=document.getElementById("ocr-input").value.trim(),o=document.getElementById("global-explanation-ref").value.trim(),a=document.getElementById("execute-btn");let n=!1;this.current==="query-only"?n=!!(t||r):this.current==="answer-only"?n=!!e:n=!!(r||o||e||t),a.disabled=!n,a.style.opacity=n?"1":"0.6"}};function w(e,t){e&&(e.disabled=t,e.setAttribute("aria-busy",String(t)),t?(e.dataset.originalText=e.dataset.originalText||e.textContent||"",e.setAttribute("aria-label","ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),e.textContent="â³ ì²˜ë¦¬ ì¤‘...",e.style.opacity="0.6"):(e.textContent=e.dataset.originalText||e.textContent,e.setAttribute("aria-label","ì‹¤í–‰"),e.style.opacity="1",e.removeAttribute("aria-busy")))}function E(e){e.style.borderColor="var(--primary, #21808d)",e.style.boxShadow="0 0 0 3px rgba(33, 128, 141, 0.2)",setTimeout(()=>{e.style.borderColor="",e.style.boxShadow=""},2e3)}function k(e){return{full_generation:"ğŸ¯ ì „ì²´ ìƒì„±",query_generation:"â“ ì§ˆì˜ ìƒì„±",answer_generation:"ğŸ’¡ ë‹µë³€ ìƒì„±",edit_query:"âœï¸ ì§ˆì˜ ìˆ˜ì •",edit_answer:"âœï¸ ë‹µë³€ ìˆ˜ì •",edit_both:"âœï¸ ì§ˆì˜+ë‹µë³€ ìˆ˜ì •",rewrite:"âœ… ì¬ì‘ì„±/ê²€ìˆ˜"}[e]||e}function L(e){const t=u.current,r=["full_generation","query_generation","edit_query","edit_both"].includes(e.workflow);if(e.query&&t!=="answer-only"&&r){const l=document.getElementById("query");l.value=e.query,E(l)}if(e.answer){const l=document.getElementById("answer");l.value=e.answer,E(l)}const o=document.getElementById("workspace-results");if(!o)return;o.innerHTML="";const a=document.createElement("div");a.className="workspace-success-message";const n=document.createElement("h3");n.className="workspace-success-heading",n.textContent=`âœ… ${k(e.workflow)} ì™„ë£Œ`,a.appendChild(n);const s=document.createElement("p");s.className="workspace-success-description";const i=[e.query?"ì§ˆì˜":"",e.answer?"ë‹µë³€":""].filter(Boolean).join("ì™€ ");s.textContent=`${i}ì´ ì…ë ¥ í•„ë“œì— ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.`,a.appendChild(s),o.appendChild(a),setTimeout(()=>{o.innerHTML=""},3e3)}function T(e,t){const o=document.getElementById(e).value.trim();if(!o){v("ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.","error");return}h(o,t)}function _(){const e=sessionStorage.getItem("workspace_query"),t=sessionStorage.getItem("workspace_answer");e&&(document.getElementById("query").value=e,sessionStorage.removeItem("workspace_query")),t&&(document.getElementById("answer").value=t,sessionStorage.removeItem("workspace_answer"))}function S(){const e=localStorage.getItem(g);e&&(document.getElementById("global-explanation-ref").value=e)}function A(){var r;let e;const t=document.getElementById("global-explanation-ref");t.addEventListener("input",o=>{clearTimeout(e);const a=o.target.value;e=setTimeout(()=>{localStorage.setItem(g,a)},300)}),(r=document.getElementById("clear-reference-btn"))==null||r.addEventListener("click",()=>{t.value="",localStorage.removeItem(g)})}function H(){const e=document.querySelectorAll(".workspace-mode-tabs .mode-tab");e.forEach(t=>{const r=t;r.addEventListener("click",()=>{e.forEach(o=>o.classList.remove("active")),r.classList.add("active"),r.dataset.mode&&u.switchTo(r.dataset.mode)}),r.addEventListener("keydown",o=>{const a=Array.from(e).indexOf(r);let n=a;o.key==="ArrowRight"&&(n=(a+1)%e.length),o.key==="ArrowLeft"&&(n=(a-1+e.length)%e.length),o.key==="Home"&&(n=0),o.key==="End"&&(n=e.length-1),n!==a&&(o.preventDefault(),e[n].click(),e[n].focus())})})}function N(){const e=x(()=>u.updateValidation(),150);["query","answer","ocr-input","global-explanation-ref"].forEach(t=>{const r=document.getElementById(t);r&&r.addEventListener("input",e)})}async function M(e,t,r,o,a){const n=document.getElementById("workspace-results");if(!n)return;n.innerHTML="";const s=document.createElement("div");s.className="workspace-loading-message";const i=document.createElement("p");i.textContent="â³ ì²˜ë¦¬ ì¤‘...",s.appendChild(i),n.appendChild(s);const l={mode:e,query:t||null,answer:r||null,edit_request:o||null,ocr_text:document.getElementById("ocr-input").value||null,query_type:document.getElementById("query-type").value||null,global_explanation_ref:document.getElementById("global-explanation-ref").value.trim()||null};e==="query-only"&&!o?l.query=null:e==="answer-only"&&!o&&(l.answer=null);try{q(l,"/api/workspace/unified")}catch(c){if(c instanceof C){n.innerHTML="";const d=document.createElement("div");d.className="workspace-error-message";const f=document.createElement("h3");f.textContent="âš ï¸ ìš”ì²­ ë°ì´í„° ì˜¤ë¥˜",d.appendChild(f);const y=document.createElement("p");y.className="workspace-error-detail",y.textContent=c.message,d.appendChild(y);const p=document.createElement("p");throw p.className="workspace-error-hint",p.textContent="ğŸ’¡ í•„ë“œëª…ê³¼ ë°ì´í„° íƒ€ì…ì„ í™•ì¸í•˜ì„¸ìš”",d.appendChild(p),n.appendChild(d),c}throw c}const m=await B({url:"/api/workspace/unified",method:"POST",body:l,signal:a,retries:2,initialDelayMs:400});L(m)}function D(){var r,o;b(),(r=document.getElementById("save-ocr-btn"))==null||r.addEventListener("click",()=>I()),_(),S(),A(),H(),N(),u.switchTo("full"),document.querySelectorAll("[data-copy-target]").forEach(a=>{const n=a;n.addEventListener("click",()=>{n.dataset.copyTarget&&T(n.dataset.copyTarget,n)})});let e=!1,t=null;(o=document.getElementById("execute-btn"))==null||o.addEventListener("click",async()=>{if(e)return;t&&t.abort(),t=new AbortController;const a=document.getElementById("execute-btn");e=!0,w(a,!0);const n=document.getElementById("query").value.trim(),s=document.getElementById("answer").value.trim(),i=document.getElementById("edit-request").value.trim();try{await M(u.current,n,s,i,t.signal)}catch(l){const m=document.getElementById("workspace-results");if(m){const c=l instanceof Error?l.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";m.innerHTML=`
                    <div style="text-align: center; padding: 20px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;">
                        <p style="color: #f44336; margin: 0;">âŒ ì‘ì—… ì‹¤íŒ¨: ${c}</p>
                    </div>
                `}}finally{e=!1,w(a,!1)}})}export{D as initWorkspace};
//# sourceMappingURL=workspace.js.map
