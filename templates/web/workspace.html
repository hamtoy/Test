{% extends "layout.html" %}

{% block content %}
<div class="split-layout">
    <!-- ì™¼ìª½: OCR ì˜ì—­ -->
    <div class="left-panel">
        <h2>ğŸ“„ OCR í…ìŠ¤íŠ¸</h2>
        <textarea id="ocr-input" class="ocr-box" rows="20" placeholder="OCR í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <button id="save-ocr-btn" class="btn-primary">ğŸ’¾ ì €ì¥</button>
        <span id="ocr-save-status" style="margin-left: 10px;"></span>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ -->
    <div class="right-panel">
        <h2>âœï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h2>
        
        <div class="form-group">
            <label>ì§ˆì˜ (ì„ íƒ)</label>
            <input type="text" id="query" placeholder="ì§ˆì˜ ë‚´ìš©">
        </div>

        <div class="form-group">
            <label>ë‹µë³€/í…ìŠ¤íŠ¸</label>
            <textarea id="answer" rows="8"></textarea>
        </div>

        <div class="form-group">
            <label>ëª¨ë“œ ì„ íƒ</label>
            <label>
                <input type="radio" name="mode" value="inspect" checked>
                ê²€ìˆ˜ ëª¨ë“œ (ìë™ êµì •)
            </label>
            <label>
                <input type="radio" name="mode" value="edit">
                ììœ  ìˆ˜ì • ëª¨ë“œ
            </label>
        </div>

        <div id="edit-request-box" style="display:none;" class="form-group">
            <label>ìˆ˜ì • ìš”ì²­</label>
            <input type="text" id="edit-request" placeholder="ì˜ˆ: ë” ê°„ê²°í•˜ê²Œ">
        </div>

        <button id="execute-btn" class="btn-primary">â–¶ï¸ ì‹¤í–‰</button>

        <div id="workspace-results" class="results-area"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ OCR í…ìŠ¤íŠ¸ ë¡œë“œ
    loadOCR();

    // ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('save-ocr-btn').addEventListener('click', saveOCR);

    // ëª¨ë“œ ì„ íƒ ì‹œ ìˆ˜ì • ìš”ì²­ ë°•ìŠ¤ í† ê¸€
    document.querySelectorAll('input[name="mode"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
            const box = document.getElementById('edit-request-box');
            box.style.display = e.target.value === 'edit' ? 'block' : 'none';
        });
    });

    document.getElementById('execute-btn').addEventListener('click', async () => {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const query = document.getElementById('query').value;
        const answer = document.getElementById('answer').value;
        const editRequest = document.getElementById('edit-request').value;

        if (!answer.trim()) {
            alert('ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (mode === 'edit' && !editRequest.trim()) {
            alert('ìˆ˜ì • ìš”ì²­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        await executeWorkspace(mode, query, answer, editRequest);
    });
</script>
{% endblock %}
