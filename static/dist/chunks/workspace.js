import{c as v,d as h,s as x,e as B,f as b}from"../app.js";import{l as I,s as q}from"./ocr.js";import{validateRequest as k,ValidationError as C}from"./validation.js";const f="workspace_global_explanation",m={current:"full",switchTo(e){this.current=e;const t=document.getElementById("query"),o=document.getElementById("answer"),r=document.getElementById("query-badge"),a=document.getElementById("answer-badge"),n=document.getElementById("query-help"),s=document.getElementById("answer-help"),c=document.getElementById("query-type-section"),l=document.getElementById("execute-btn");t.readOnly=!1,o.readOnly=!1,t.classList.remove("output-only","required-input"),o.classList.remove("output-only","required-input"),e==="full"?(r.textContent="ì„ íƒ",r.className="field-badge optional",a.textContent="ì„ íƒ",a.className="field-badge optional",n.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",s.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",t.placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",o.placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",c.style.display="block",l.textContent="ğŸš€ ì‹¤í–‰"):e==="query-only"?(r.textContent="ìë™ ìƒì„±",r.className="field-badge output",a.textContent="í•„ìˆ˜ ì…ë ¥",a.className="field-badge required",n.innerHTML="ğŸ¤– <strong>ë‹µë³€ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",s.innerHTML="âœ… <strong>ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ì§ˆë¬¸ ìƒì„±)",t.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì§ˆë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤",o.placeholder="ì§ˆë¬¸ì„ ìƒì„±í•  ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”",t.readOnly=!0,t.classList.add("output-only"),o.classList.add("required-input"),c.style.display="none",l.textContent="â“ ì§ˆë¬¸ ìƒì„±"):e==="answer-only"&&(r.textContent="í•„ìˆ˜ ì…ë ¥",r.className="field-badge required",a.textContent="ìë™ ìƒì„±",a.className="field-badge output",n.innerHTML="âœ… <strong>ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ë‹µë³€ ìƒì„±)",s.innerHTML="ğŸ¤– <strong>ì§ˆë¬¸ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",t.placeholder="ë‹µë³€ì„ ìƒì„±í•  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",o.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ë‹µë³€ì´ í‘œì‹œë©ë‹ˆë‹¤",o.readOnly=!0,o.classList.add("output-only"),t.classList.add("required-input"),c.style.display="block",l.textContent="ğŸ’¡ ë‹µë³€ ìƒì„±"),this.updateValidation()},updateValidation(){const e=document.getElementById("query").value.trim(),t=document.getElementById("answer").value.trim(),o=document.getElementById("ocr-input").value.trim(),r=document.getElementById("global-explanation-ref").value.trim(),a=document.getElementById("execute-btn");let n=!1;this.current==="query-only"?n=!!(t||o):this.current==="answer-only"?n=!!e:n=!!(o||r||e||t),a.disabled=!n,a.style.opacity=n?"1":"0.6"}};function E(e,t){e&&(e.disabled=t,e.setAttribute("aria-busy",String(t)),t?(e.dataset.originalText=e.dataset.originalText||e.textContent||"",e.setAttribute("aria-label","ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),e.textContent="â³ ì²˜ë¦¬ ì¤‘...",e.style.opacity="0.6"):(e.textContent=e.dataset.originalText||e.textContent,e.setAttribute("aria-label","ì‹¤í–‰"),e.style.opacity="1",e.removeAttribute("aria-busy")))}function w(e){e.style.borderColor="var(--primary, #21808d)",e.style.boxShadow="0 0 0 3px rgba(33, 128, 141, 0.2)",setTimeout(()=>{e.style.borderColor="",e.style.boxShadow=""},2e3)}function L(e){return{full_generation:"ğŸ¯ ì „ì²´ ìƒì„±",query_generation:"â“ ì§ˆì˜ ìƒì„±",answer_generation:"ğŸ’¡ ë‹µë³€ ìƒì„±",edit_query:"âœï¸ ì§ˆì˜ ìˆ˜ì •",edit_answer:"âœï¸ ë‹µë³€ ìˆ˜ì •",edit_both:"âœï¸ ì§ˆì˜+ë‹µë³€ ìˆ˜ì •",rewrite:"âœ… ì¬ì‘ì„±/ê²€ìˆ˜"}[e]||e}function T(e){const t=m.current,o=["full_generation","query_generation","edit_query","edit_both"].includes(e.workflow);if(e.query&&t!=="answer-only"&&o){const l=document.getElementById("query");l.value=e.query,w(l)}if(e.answer){const l=document.getElementById("answer");l.value=e.answer,w(l)}const r=document.getElementById("workspace-results");if(!r)return;r.innerHTML="";const a=document.createElement("div");a.className="workspace-success-message";const n=document.createElement("h3");n.className="workspace-success-heading",n.textContent=`âœ… ${L(e.workflow)} ì™„ë£Œ`,a.appendChild(n);const s=document.createElement("p");s.className="workspace-success-description";const c=[e.query?"ì§ˆì˜":"",e.answer?"ë‹µë³€":""].filter(Boolean).join("ì™€ ");s.textContent=`${c}ì´ ì…ë ¥ í•„ë“œì— ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.`,a.appendChild(s),r.appendChild(a),setTimeout(()=>{r.innerHTML=""},3e3)}function _(e,t){const r=document.getElementById(e).value.trim();if(!r){x("ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.","error");return}B(r,t)}function S(){const e=sessionStorage.getItem("workspace_query"),t=sessionStorage.getItem("workspace_answer");e&&(document.getElementById("query").value=e,sessionStorage.removeItem("workspace_query")),t&&(document.getElementById("answer").value=t,sessionStorage.removeItem("workspace_answer"))}function A(){const e=localStorage.getItem(f);e&&(document.getElementById("global-explanation-ref").value=e)}function H(){var o;let e;const t=document.getElementById("global-explanation-ref");t.addEventListener("input",r=>{clearTimeout(e);const a=r.target.value;e=setTimeout(()=>{localStorage.setItem(f,a)},300)}),(o=document.getElementById("clear-reference-btn"))==null||o.addEventListener("click",()=>{t.value="",localStorage.removeItem(f)})}function N(){const e=document.querySelectorAll(".workspace-mode-tabs .mode-tab");e.forEach(t=>{const o=t;o.addEventListener("click",()=>{e.forEach(r=>r.classList.remove("active")),o.classList.add("active"),o.dataset.mode&&m.switchTo(o.dataset.mode)}),o.addEventListener("keydown",r=>{const a=Array.from(e).indexOf(o);let n=a;r.key==="ArrowRight"&&(n=(a+1)%e.length),r.key==="ArrowLeft"&&(n=(a-1+e.length)%e.length),r.key==="Home"&&(n=0),r.key==="End"&&(n=e.length-1),n!==a&&(r.preventDefault(),e[n].click(),e[n].focus())})})}function M(){const e=h(()=>m.updateValidation(),150);["query","answer","ocr-input","global-explanation-ref"].forEach(t=>{const o=document.getElementById(t);o&&o.addEventListener("input",e)})}async function R(e,t,o,r,a){const n=document.getElementById("workspace-results");if(!n)return;n.innerHTML="";const s=document.createElement("div");s.className="workspace-loading-message";const c=document.createElement("p");c.textContent="â³ ì²˜ë¦¬ ì¤‘...",s.appendChild(c),n.appendChild(s);const l={mode:e,query:t||null,answer:o||null,edit_request:r||null,ocr_text:document.getElementById("ocr-input").value||null,query_type:document.getElementById("query-type").value||null,global_explanation_ref:document.getElementById("global-explanation-ref").value.trim()||null};e==="query-only"&&!r?l.query=null:e==="answer-only"&&!r&&(l.answer=null);try{k(l,"/api/workspace/unified")}catch(d){if(d instanceof C){n.innerHTML="";const i=document.createElement("div");i.className="workspace-error-message";const u=document.createElement("h3");u.textContent="âš ï¸ ìš”ì²­ ë°ì´í„° ì˜¤ë¥˜",i.appendChild(u);const p=document.createElement("p");p.className="workspace-error-detail",p.textContent=d.message,i.appendChild(p);const g=document.createElement("p");throw g.className="workspace-error-hint",g.textContent="ğŸ’¡ í•„ë“œëª…ê³¼ ë°ì´í„° íƒ€ì…ì„ í™•ì¸í•˜ì„¸ìš”",i.appendChild(g),n.appendChild(i),d}throw d}const y=await b({url:"/api/workspace/unified",method:"POST",body:l,signal:a,retries:2,initialDelayMs:400});T(y)}function F(){var o,r;I(),(o=document.getElementById("save-ocr-btn"))==null||o.addEventListener("click",()=>q()),S(),A(),H(),N(),M(),m.switchTo("full"),document.querySelectorAll("[data-copy-target]").forEach(a=>{const n=a;n.addEventListener("click",()=>{n.dataset.copyTarget&&_(n.dataset.copyTarget,n)})}),document.querySelectorAll(".btn-primary").forEach(a=>{a.addEventListener("click",n=>v(n))});let e=!1,t=null;(r=document.getElementById("execute-btn"))==null||r.addEventListener("click",async()=>{if(e)return;t&&t.abort(),t=new AbortController;const a=document.getElementById("execute-btn");e=!0,E(a,!0);const n=document.getElementById("query").value.trim(),s=document.getElementById("answer").value.trim(),c=document.getElementById("edit-request").value.trim();try{await R(m.current,n,s,c,t.signal)}catch(l){const y=document.getElementById("workspace-results");if(y){const d=l instanceof Error?l.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";y.innerHTML=`
                    <div class="error-state" role="alert" aria-live="assertive">
                        <div class="error-state__icon">âš ï¸</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--accent-danger);">ì‘ì—… ì‹¤íŒ¨</h3>
                        <p class="error-state__text">${d}</p>
                        <button id="retry-btn" class="retry-btn">
                            ğŸ”„ ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;const i=document.getElementById("retry-btn");i&&(i.addEventListener("click",()=>{var u;(u=document.getElementById("execute-btn"))==null||u.click()}),setTimeout(()=>i.focus(),100))}}finally{e=!1,E(a,!1)}})}export{F as initWorkspace};
//# sourceMappingURL=workspace.js.map
