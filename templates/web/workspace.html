{% extends "layout.html" %}

{% block content %}
<div class="split-layout">
    <!-- ì™¼ìª½: OCR ì˜ì—­ -->
    <div class="left-panel">
    <h2>ğŸ“„ OCR í…ìŠ¤íŠ¸</h2>
        <textarea id="ocr-input" class="ocr-box" rows="15" placeholder="OCR í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <div class="btn-row">
            <button id="save-ocr-btn" class="btn-primary" style="width: 100%;">ğŸ’¾ ì €ì¥</button>
        </div>
        <span id="ocr-save-status" class="status-text"></span>

    <!-- ì „ì²´ ì„¤ëª…ë¬¸ ì°¸ì¡° ì˜ì—­ -->
    <div class="reference-section" style="margin-top: 20px;">
        <div class="reference-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <h3 style="margin: 0; font-size: 14px; color: var(--text-primary, #333);">ğŸ“ ì „ì²´ ì„¤ëª…ë¬¸ (ì°¸ì¡°ìš©)</h3>
            <button id="clear-reference-btn" class="btn-small" type="button" style="padding: 4px 8px; font-size: 11px;">ì§€ìš°ê¸°</button>
        </div>
        <textarea
            id="global-explanation-ref"
            class="reference-box"
            rows="8"
            placeholder="ì „ì²´ ì„¤ëª…ë¬¸ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\n\níƒ€ê²Ÿ ë‹¨ë‹µí˜•/ì¥ë‹µí˜• ìƒì„± ì‹œ ì´ ë‚´ìš©ê³¼ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ì§ˆì˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤."
            style="width: 100%; padding: 10px; font-size: 13px; border: 1px dashed var(--border, #ccc); border-radius: 6px; background: var(--bg-secondary, #f9f9f9); resize: vertical;"
        ></textarea>
        <small style="display: block; margin-top: 6px; color: var(--text-secondary, #888); font-size: 12px;">
            ğŸ’¡ QA ìƒì„± ê²°ê³¼ì—ì„œ ì „ì²´ ì„¤ëª…ë¬¸ì„ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”
        </small>
    </div>
</div>

    <!-- ì˜¤ë¥¸ìª½: í†µí•© ì›Œí¬ìŠ¤í˜ì´ìŠ¤ -->
    <div class="right-panel">
        <h2>ğŸ”¥ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h2>

        <!-- íƒ­ ì„ íƒ -->
        <div class="workspace-mode-tabs" role="tablist" aria-label="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ëª¨ë“œ ì„ íƒ">
            <button class="mode-tab active" data-mode="full" role="tab" aria-selected="true" aria-controls="workspace-panel">ğŸ”¥ ì „ì²´</button>
            <button class="mode-tab" data-mode="query-only" role="tab" aria-selected="false" aria-controls="workspace-panel">â“ ì§ˆë¬¸ë§Œ</button>
            <button class="mode-tab" data-mode="answer-only" role="tab" aria-selected="false" aria-controls="workspace-panel">ğŸ’¡ ë‹µë³€ë§Œ</button>
        </div>
        
        <!-- ì§ˆì˜ ì…ë ¥ -->
        <div class="form-group" id="query-section">
            <label for="query">
                ì§ˆì˜
                <span class="field-badge optional" id="query-badge">ì„ íƒ</span>
            </label>
            <div class="input-with-copy">
                <textarea id="query" rows="3" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ OCRì—ì„œ ìë™ ìƒì„±)"></textarea>
                <button type="button" class="copy-btn-float" data-copy-target="query">ğŸ“‹</button>
            </div>
            <small class="help-text" id="query-help">ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤</small>
        </div>

        <!-- ë‹µë³€ ì…ë ¥ -->
        <div class="form-group" id="answer-section">
            <label for="answer">
                ë‹µë³€
                <span class="field-badge optional" id="answer-badge">ì„ íƒ</span>
            </label>
            <div class="input-with-copy">
                <textarea id="answer" rows="8" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ì§ˆë¬¸ ê¸°ë°˜ ìë™ ìƒì„±)"></textarea>
                <button type="button" class="copy-btn-float" data-copy-target="answer">ğŸ“‹</button>
            </div>
            <small class="help-text" id="answer-help">ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤</small>
        </div>

        <!-- ì§ˆë¬¸/ë‹µë³€ ìœ í˜• ì„ íƒ -->
        <div class="form-group" id="query-type-section">
            <label for="query-type">ì§ˆë¬¸/ë‹µë³€ ìœ í˜• (ì„ íƒ)</label>
            <select
                id="query-type"
                style="width: 100%; padding: 12px; border: 1px solid var(--border, rgba(94, 82, 64, 0.2)); border-radius: 6px; font-size: 14px; background: var(--surface, #fffffe); color: var(--text-primary, #1f2121);"
            >
                <option value="">ìë™ ê°ì§€</option>
                <option value="global_explanation">ì „ë°˜ ì„¤ëª…</option>
                <option value="reasoning">ì¶”ë¡ </option>
                <option value="target_short">íƒ€ê²Ÿ ë‹¨ë‹µ</option>
                <option value="target_long">íƒ€ê²Ÿ ì¥ë‹µ</option>
            </select>
            <small style="color: var(--text-secondary, #666); font-size: 0.85em;">
                ğŸ¯ ìƒì„±í•  ì§ˆì˜/ë‹µë³€ì˜ ìŠ¤íƒ€ì¼ì„ ì§€ì •í•©ë‹ˆë‹¤
            </small>
        </div>

        <!-- ìˆ˜ì • ìš”ì²­ (ì„ íƒ) -->
        <div class="form-group">
            <label for="edit-request">ìˆ˜ì • ìš”ì²­ (ì„ íƒ)</label>
            <input type="text" id="edit-request" placeholder="ì˜ˆ: ë” ê°„ê²°í•˜ê²Œ, ìˆ«ì ê°•ì¡°, ë¬¸ì¥ ë‹¤ë“¬ê¸°...">
            <small style="color: var(--text-secondary, #666); font-size: 0.85em;">
                âœï¸ ì§ˆì˜ë‚˜ ë‹µë³€ì„ ìˆ˜ì •í•˜ê³  ì‹¶ì„ ë•Œ ì…ë ¥í•˜ì„¸ìš”
            </small>
        </div>

        <!-- ì‹¤í–‰ ë²„íŠ¼ -->
        <button 
            id="execute-btn" 
            class="btn-primary" 
            style="width: 100%; padding: 14px; font-size: 16px; font-weight: 600;"
            aria-label="ì„ íƒí•œ ëª¨ë“œì— ë”°ë¼ ì§ˆì˜ì™€ ë‹µë³€ ìƒì„±"
            aria-describedby="execute-help">
            ğŸš€ ì‹¤í–‰
        </button>
        <div id="execute-help" class="sr-only">
            í˜„ì¬ ì„ íƒëœ ëª¨ë“œì™€ ì…ë ¥ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ AIê°€ ì§ˆì˜ì™€ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="workspace-results" class="results-area" role="region" aria-live="polite" aria-atomic="true" aria-label="ì‘ì—… ê²°ê³¼"></div>
    </div>
</div>

<style>
    .form-group {
        margin-bottom: 24px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-primary, #1f2121);
        font-size: 14px;
    }

    .form-group textarea,
    .form-group input[type="text"] {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border, rgba(94, 82, 64, 0.2));
        border-radius: 6px;
        font-size: 14px;
        font-family: inherit;
        background: var(--surface, #fffffe);
        color: var(--text-primary, #1f2121);
        transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-group textarea:focus,
    .form-group input[type="text"]:focus {
        outline: none;
        border-color: var(--primary, #21808d);
        box-shadow: 0 0 0 3px rgba(33, 128, 141, 0.1);
    }

    .form-group textarea {
        resize: vertical;
    }

    .form-group small {
        display: block;
        margin-top: 6px;
    }

    .workflow-badge {
        display: inline-block;
        padding: 6px 14px;
        background: var(--primary, #21808d);
        color: white;
        border-radius: 5px;
        font-size: 0.85em;
        font-weight: 600;
        margin-bottom: 12px;
    }

    .result-card {
        background: var(--surface, #fffffe);
        border: 1px solid var(--border, rgba(94, 82, 64, 0.12));
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }

    .result-section {
        margin: 15px 0;
        padding: 12px;
        background: var(--bg-secondary, #f5f5f5);
        border-radius: 5px;
        border-left: 3px solid var(--primary, #21808d);
    }

    .result-section strong {
        display: block;
        margin-bottom: 8px;
        color: var(--text-primary, #1f2121);
    }

    .workspace-mode-tabs {
        display: flex;
        gap: 10px;
        margin: 12px 0 20px;
    }

    .workspace-mode-tabs .mode-tab {
        flex: 1;
        padding: 10px 12px;
        border: 1px solid var(--border, rgba(94, 82, 64, 0.2));
        border-radius: 8px;
        background: var(--bg-secondary, #f5f5f5);
        color: var(--text-primary, #1f2121);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .workspace-mode-tabs .mode-tab:hover {
        border-color: var(--primary, #21808d);
        color: var(--primary, #21808d);
    }

    .workspace-mode-tabs .mode-tab.active {
        background: var(--accent-primary-soft, rgba(16, 185, 129, 0.1));
        border-color: var(--accent-primary, #10b981);
        color: var(--accent-primary, #10b981);
    }

    .field-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 700;
        margin-left: 8px;
        vertical-align: middle;
    }

    .field-badge.optional {
        background: var(--bg-tertiary, #ececec);
        color: var(--text-secondary, #666);
    }

    .field-badge.required {
        background: var(--accent-primary, #10b981);
        color: #fff;
    }

    .field-badge.output {
        background: var(--accent-secondary, #3b82f6);
        color: #fff;
    }

    textarea.output-only {
        background: var(--bg-secondary, #f5f5f5);
        border: 2px dashed var(--accent-secondary, #3b82f6);
        font-style: italic;
        cursor: not-allowed;
    }

    textarea.required-input {
        border: 2px solid var(--accent-primary, #10b981);
        box-shadow: 0 0 0 3px var(--accent-primary-soft, rgba(16, 185, 129, 0.15));
    }
</style>

{% endblock %}
