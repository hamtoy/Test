import{s as g,c as f,d as x}from"../app.js";import{l as v,s as w}from"./ocr.js";import{validateRequest as b,ValidationError as E}from"./validation.js";const d="workspace_global_explanation",c={current:"full",switchTo(e){this.current=e;const t=document.getElementById("query"),r=document.getElementById("answer"),n=document.getElementById("query-badge"),o=document.getElementById("answer-badge"),l=document.getElementById("query-help"),s=document.getElementById("answer-help"),i=document.getElementById("query-type-section"),a=document.getElementById("execute-btn");t.readOnly=!1,r.readOnly=!1,t.classList.remove("output-only","required-input"),r.classList.remove("output-only","required-input"),e==="full"?(n.textContent="ì„ íƒ",n.className="field-badge optional",o.textContent="ì„ íƒ",o.className="field-badge optional",l.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",s.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",t.placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",r.placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",i.style.display="block",a.textContent="ğŸš€ ì‹¤í–‰"):e==="query-only"?(n.textContent="ìë™ ìƒì„±",n.className="field-badge output",o.textContent="í•„ìˆ˜ ì…ë ¥",o.className="field-badge required",l.innerHTML="ğŸ¤– <strong>ë‹µë³€ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",s.innerHTML="âœ… <strong>ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ì§ˆë¬¸ ìƒì„±)",t.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì§ˆë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤",r.placeholder="ì§ˆë¬¸ì„ ìƒì„±í•  ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”",t.readOnly=!0,t.classList.add("output-only"),r.classList.add("required-input"),i.style.display="none",a.textContent="â“ ì§ˆë¬¸ ìƒì„±"):e==="answer-only"&&(n.textContent="í•„ìˆ˜ ì…ë ¥",n.className="field-badge required",o.textContent="ìë™ ìƒì„±",o.className="field-badge output",l.innerHTML="âœ… <strong>ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ë‹µë³€ ìƒì„±)",s.innerHTML="ğŸ¤– <strong>ì§ˆë¬¸ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",t.placeholder="ë‹µë³€ì„ ìƒì„±í•  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",r.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ë‹µë³€ì´ í‘œì‹œë©ë‹ˆë‹¤",r.readOnly=!0,r.classList.add("output-only"),t.classList.add("required-input"),i.style.display="block",a.textContent="ğŸ’¡ ë‹µë³€ ìƒì„±"),this.updateValidation()},updateValidation(){const e=document.getElementById("query").value.trim(),t=document.getElementById("answer").value.trim(),r=document.getElementById("ocr-input").value.trim(),n=document.getElementById("global-explanation-ref").value.trim(),o=document.getElementById("execute-btn");let l=!1;this.current==="query-only"?l=!!(t||r):this.current==="answer-only"?l=!!e:l=!!(r||n||e||t),o.disabled=!l,o.style.opacity=l?"1":"0.6"}};function y(e,t){e&&(e.disabled=t,e.setAttribute("aria-busy",String(t)),t?(e.dataset.originalText=e.dataset.originalText||e.textContent||"",e.setAttribute("aria-label","ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),e.textContent="â³ ì²˜ë¦¬ ì¤‘...",e.style.opacity="0.6"):(e.textContent=e.dataset.originalText||e.textContent,e.setAttribute("aria-label","ì‹¤í–‰"),e.style.opacity="1",e.removeAttribute("aria-busy")))}function m(e){e.style.borderColor="var(--primary, #21808d)",e.style.boxShadow="0 0 0 3px rgba(33, 128, 141, 0.2)",setTimeout(()=>{e.style.borderColor="",e.style.boxShadow=""},2e3)}function B(e){return{full_generation:"ğŸ¯ ì „ì²´ ìƒì„±",query_generation:"â“ ì§ˆì˜ ìƒì„±",answer_generation:"ğŸ’¡ ë‹µë³€ ìƒì„±",edit_query:"âœï¸ ì§ˆì˜ ìˆ˜ì •",edit_answer:"âœï¸ ë‹µë³€ ìˆ˜ì •",edit_both:"âœï¸ ì§ˆì˜+ë‹µë³€ ìˆ˜ì •",rewrite:"âœ… ì¬ì‘ì„±/ê²€ìˆ˜"}[e]||e}function h(e){const t=c.current,r=["full_generation","query_generation","edit_query","edit_both"].includes(e.workflow);if(e.query&&t!=="answer-only"&&r){const o=document.getElementById("query");o.value=e.query,m(o)}if(e.answer){const o=document.getElementById("answer");o.value=e.answer,m(o)}const n=document.getElementById("workspace-results");n&&(n.innerHTML=`
        <div style="text-align: center; padding: 20px; background: #e8f5e9; border-radius: 8px; border: 1px solid #4caf50; margin-top: 20px; animation: fadeIn 0.3s;">
            <h3 style="margin: 0 0 10px 0; color: #4caf50;">âœ… ${B(e.workflow)} ì™„ë£Œ</h3>
            <p style="margin: 0; color: #666; font-size: 0.9em;">
                ${e.query?"ì§ˆì˜":""}${e.query&&e.answer?"ì™€ ":""}${e.answer?"ë‹µë³€":""}ì´ ì…ë ¥ í•„ë“œì— ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.
            </p>
        </div>
    `,setTimeout(()=>{n.innerHTML=""},3e3))}function I(e,t){const n=document.getElementById(e).value.trim();if(!n){g("ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.","error");return}f(n,t)}function q(){const e=sessionStorage.getItem("workspace_query"),t=sessionStorage.getItem("workspace_answer");e&&(document.getElementById("query").value=e,sessionStorage.removeItem("workspace_query")),t&&(document.getElementById("answer").value=t,sessionStorage.removeItem("workspace_answer"))}function k(){const e=localStorage.getItem(d);e&&(document.getElementById("global-explanation-ref").value=e)}function T(){var r;let e;const t=document.getElementById("global-explanation-ref");t.addEventListener("input",n=>{clearTimeout(e);const o=n.target.value;e=setTimeout(()=>{localStorage.setItem(d,o)},300)}),(r=document.getElementById("clear-reference-btn"))==null||r.addEventListener("click",()=>{t.value="",localStorage.removeItem(d)})}function L(){const e=document.querySelectorAll(".workspace-mode-tabs .mode-tab");e.forEach(t=>{const r=t;r.addEventListener("click",()=>{e.forEach(n=>n.classList.remove("active")),r.classList.add("active"),r.dataset.mode&&c.switchTo(r.dataset.mode)}),r.addEventListener("keydown",n=>{const o=Array.from(e).indexOf(r);let l=o;n.key==="ArrowRight"&&(l=(o+1)%e.length),n.key==="ArrowLeft"&&(l=(o-1+e.length)%e.length),n.key==="Home"&&(l=0),n.key==="End"&&(l=e.length-1),l!==o&&(n.preventDefault(),e[l].click(),e[l].focus())})})}function C(){let e;const t=()=>{clearTimeout(e),e=setTimeout(()=>c.updateValidation(),150)};["query","answer","ocr-input","global-explanation-ref"].forEach(r=>{const n=document.getElementById(r);n&&n.addEventListener("input",t)})}async function _(e,t,r,n,o){const l=document.getElementById("workspace-results");if(!l)return;l.innerHTML=`
        <div style="text-align: center; padding: 20px; background: var(--bg-secondary, #f5f5f5); border-radius: 8px; margin-top: 20px;">
            <p style="color: var(--text-primary, #1f2121); margin: 0;">â³ ì²˜ë¦¬ ì¤‘...</p>
        </div>
    `;const s={mode:e,query:t||null,answer:r||null,edit_request:n||null,ocr_text:document.getElementById("ocr-input").value||null,query_type:document.getElementById("query-type").value||null,global_explanation_ref:document.getElementById("global-explanation-ref").value.trim()||null};e==="query-only"&&!n?s.query=null:e==="answer-only"&&!n&&(s.answer=null);try{b(s,"/api/workspace/unified")}catch(a){throw a instanceof E&&(l.innerHTML=`
                <div style="text-align: center; padding: 30px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;">
                    <h3 style="color: #f44336; margin-bottom: 10px;">âš ï¸ ìš”ì²­ ë°ì´í„° ì˜¤ë¥˜</h3>
                    <p style="color: #666; margin: 0; white-space: pre-line;">${a.message}</p>
                    <p style="color: #999; margin-top: 15px; font-size: 0.9em;">ğŸ’¡ í•„ë“œëª…ê³¼ ë°ì´í„° íƒ€ì…ì„ í™•ì¸í•˜ì„¸ìš”</p>
                </div>
            `),a}const i=await x({url:"/api/workspace/unified",method:"POST",body:s,signal:o,retries:2,initialDelayMs:400});h(i)}function M(){var r,n;v(),(r=document.getElementById("save-ocr-btn"))==null||r.addEventListener("click",()=>w()),q(),k(),T(),L(),C(),c.switchTo("full"),document.querySelectorAll("[data-copy-target]").forEach(o=>{const l=o;l.addEventListener("click",()=>{l.dataset.copyTarget&&I(l.dataset.copyTarget,l)})});let e=!1,t=null;(n=document.getElementById("execute-btn"))==null||n.addEventListener("click",async()=>{if(e)return;t&&t.abort(),t=new AbortController;const o=document.getElementById("execute-btn");e=!0,y(o,!0);const l=document.getElementById("query").value.trim(),s=document.getElementById("answer").value.trim(),i=document.getElementById("edit-request").value.trim();try{await _(c.current,l,s,i,t.signal)}catch(a){const u=document.getElementById("workspace-results");if(u){const p=a instanceof Error?a.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";u.innerHTML=`
                    <div style="text-align: center; padding: 20px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;">
                        <p style="color: #f44336; margin: 0;">âŒ ì‘ì—… ì‹¤íŒ¨: ${p}</p>
                    </div>
                `}}finally{e=!1,y(o,!1)}})}export{M as initWorkspace};
//# sourceMappingURL=workspace.js.map
