import{c as v,d as h,s as x,e as B,f as b}from"./utils.NDa8fJII.js";import{l as I,s as q}from"./ocr.BSf6QOB3.js";import{validateRequest as k,ValidationError as C}from"./validation.DRcAY0lR.js";const g="workspace_global_explanation",u={current:"full",switchTo(e){this.current=e;const n=document.getElementById("query"),r=document.getElementById("answer"),t=document.getElementById("query-badge"),a=document.getElementById("answer-badge"),o=document.getElementById("query-help"),s=document.getElementById("answer-help"),c=document.getElementById("query-type-section"),l=document.getElementById("execute-btn");n.readOnly=!1,r.readOnly=!1,n.classList.remove("output-only","required-input"),r.classList.remove("output-only","required-input"),e==="full"?(t.textContent="ì„ íƒ",t.className="field-badge optional",a.textContent="ì„ íƒ",a.className="field-badge optional",o.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",s.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",n.placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",r.placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",c.style.display="block",l.textContent="ğŸš€ ì‹¤í–‰"):e==="query-only"?(t.textContent="ìë™ ìƒì„±",t.className="field-badge output",a.textContent="í•„ìˆ˜ ì…ë ¥",a.className="field-badge required",o.innerHTML="ğŸ¤– <strong>ë‹µë³€ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",s.innerHTML="âœ… <strong>ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ì§ˆë¬¸ ìƒì„±)",n.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì§ˆë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤",r.placeholder="ì§ˆë¬¸ì„ ìƒì„±í•  ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”",n.readOnly=!0,n.classList.add("output-only"),r.classList.add("required-input"),c.style.display="none",l.textContent="â“ ì§ˆë¬¸ ìƒì„±"):e==="answer-only"&&(t.textContent="í•„ìˆ˜ ì…ë ¥",t.className="field-badge required",a.textContent="ìë™ ìƒì„±",a.className="field-badge output",o.innerHTML="âœ… <strong>ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ë‹µë³€ ìƒì„±)",s.innerHTML="ğŸ¤– <strong>ì§ˆë¬¸ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",n.placeholder="ë‹µë³€ì„ ìƒì„±í•  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",r.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ë‹µë³€ì´ í‘œì‹œë©ë‹ˆë‹¤",r.readOnly=!0,r.classList.add("output-only"),n.classList.add("required-input"),c.style.display="block",l.textContent="ğŸ’¡ ë‹µë³€ ìƒì„±"),this.updateValidation()},updateValidation(){const e=document.getElementById("query").value.trim(),n=document.getElementById("answer").value.trim(),r=document.getElementById("ocr-input").value.trim(),t=document.getElementById("global-explanation-ref").value.trim(),a=document.getElementById("execute-btn");let o=!1;this.current==="query-only"?o=!!(n||r):this.current==="answer-only"?o=!!e:o=!!(r||t||e||n),a.disabled=!o,a.style.opacity=o?"1":"0.6"}};function E(e,n){e&&(e.disabled=n,e.setAttribute("aria-busy",String(n)),n?(e.dataset.originalText=e.dataset.originalText||e.textContent||"",e.setAttribute("aria-label","ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),e.textContent="â³ ì²˜ë¦¬ ì¤‘...",e.style.opacity="0.6"):(e.textContent=e.dataset.originalText||e.textContent,e.setAttribute("aria-label","ì‹¤í–‰"),e.style.opacity="1",e.removeAttribute("aria-busy")))}function w(e){e.style.borderColor="var(--primary, #21808d)",e.style.boxShadow="0 0 0 3px rgba(33, 128, 141, 0.2)",setTimeout(()=>{e.style.borderColor="",e.style.boxShadow=""},2e3)}function L(e){return{full_generation:"ğŸ¯ ì „ì²´ ìƒì„±",query_generation:"â“ ì§ˆì˜ ìƒì„±",answer_generation:"ğŸ’¡ ë‹µë³€ ìƒì„±",edit_query:"âœï¸ ì§ˆì˜ ìˆ˜ì •",edit_answer:"âœï¸ ë‹µë³€ ìˆ˜ì •",edit_both:"âœï¸ ì§ˆì˜+ë‹µë³€ ìˆ˜ì •",rewrite:"âœ… ì¬ì‘ì„±/ê²€ìˆ˜"}[e]||e}function T(e){const n=u.current,r=["full_generation","query_generation","edit_query","edit_both"].includes(e.workflow);if(e.query&&n!=="answer-only"&&r){const l=document.getElementById("query");l.value=e.query,w(l)}if(e.answer){const l=document.getElementById("answer");l.value=e.answer,w(l)}const t=document.getElementById("workspace-results");if(!t)return;t.innerHTML="";const a=document.createElement("div");a.className="workspace-success-message";const o=document.createElement("h3");o.className="workspace-success-heading",o.textContent=`âœ… ${L(e.workflow)} ì™„ë£Œ`,a.appendChild(o);const s=document.createElement("p");s.className="workspace-success-description";const c=[e.query?"ì§ˆì˜":"",e.answer?"ë‹µë³€":""].filter(Boolean).join("ì™€ ");s.textContent=`${c}ì´ ì…ë ¥ í•„ë“œì— ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.`,a.appendChild(s),t.appendChild(a),setTimeout(()=>{t.innerHTML=""},3e3)}function _(e,n){const t=document.getElementById(e).value.trim();if(!t){x("ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.","error");return}B(t,n)}function S(){const e=sessionStorage.getItem("workspace_query"),n=sessionStorage.getItem("workspace_answer");e&&(document.getElementById("query").value=e,sessionStorage.removeItem("workspace_query")),n&&(document.getElementById("answer").value=n,sessionStorage.removeItem("workspace_answer"))}function A(){const e=localStorage.getItem(g);e&&(document.getElementById("global-explanation-ref").value=e)}function H(){let e;const n=document.getElementById("global-explanation-ref");n.addEventListener("input",r=>{clearTimeout(e);const t=r.target.value;e=setTimeout(()=>{localStorage.setItem(g,t)},300)}),document.getElementById("clear-reference-btn")?.addEventListener("click",()=>{n.value="",localStorage.removeItem(g)})}function N(){const e=document.querySelectorAll(".workspace-mode-tabs .mode-tab");e.forEach(n=>{const r=n;r.addEventListener("click",()=>{e.forEach(t=>t.classList.remove("active")),r.classList.add("active"),r.dataset.mode&&u.switchTo(r.dataset.mode)}),r.addEventListener("keydown",t=>{const a=Array.from(e).indexOf(r);let o=a;t.key==="ArrowRight"&&(o=(a+1)%e.length),t.key==="ArrowLeft"&&(o=(a-1+e.length)%e.length),t.key==="Home"&&(o=0),t.key==="End"&&(o=e.length-1),o!==a&&(t.preventDefault(),e[o].click(),e[o].focus())})})}function M(){const e=h(()=>u.updateValidation(),150);["query","answer","ocr-input","global-explanation-ref"].forEach(n=>{const r=document.getElementById(n);r&&r.addEventListener("input",e)})}async function R(e,n,r,t,a){const o=document.getElementById("workspace-results");if(!o)return;o.innerHTML="";const s=document.createElement("div");s.className="workspace-loading-message";const c=document.createElement("p");c.textContent="â³ ì²˜ë¦¬ ì¤‘...",s.appendChild(c),o.appendChild(s);const l={mode:e,query:n||null,answer:r||null,edit_request:t||null,ocr_text:document.getElementById("ocr-input").value||null,query_type:document.getElementById("query-type").value||null,global_explanation_ref:document.getElementById("global-explanation-ref").value.trim()||null};e==="query-only"&&!t?l.query=null:e==="answer-only"&&!t&&(l.answer=null);try{k(l,"/api/workspace/unified")}catch(m){if(m instanceof C){o.innerHTML="";const d=document.createElement("div");d.className="workspace-error-message";const f=document.createElement("h3");f.textContent="âš ï¸ ìš”ì²­ ë°ì´í„° ì˜¤ë¥˜",d.appendChild(f);const y=document.createElement("p");y.className="workspace-error-detail",y.textContent=m.message,d.appendChild(y);const p=document.createElement("p");throw p.className="workspace-error-hint",p.textContent="ğŸ’¡ í•„ë“œëª…ê³¼ ë°ì´í„° íƒ€ì…ì„ í™•ì¸í•˜ì„¸ìš”",d.appendChild(p),o.appendChild(d),m}throw m}const i=await b({url:"/api/workspace/unified",method:"POST",body:l,signal:a,retries:2,initialDelayMs:400});T(i)}function F(){I(),document.getElementById("save-ocr-btn")?.addEventListener("click",()=>q()),S(),A(),H(),N(),M(),u.switchTo("full"),document.querySelectorAll("[data-copy-target]").forEach(r=>{const t=r;t.addEventListener("click",()=>{t.dataset.copyTarget&&_(t.dataset.copyTarget,t)})}),document.querySelectorAll(".btn-primary").forEach(r=>{r.addEventListener("click",t=>v(t))});let e=!1,n=null;document.getElementById("execute-btn")?.addEventListener("click",async()=>{if(e)return;n&&n.abort(),n=new AbortController;const r=document.getElementById("execute-btn");e=!0,E(r,!0);const t=document.getElementById("query").value.trim(),a=document.getElementById("answer").value.trim(),o=document.getElementById("edit-request").value.trim();try{await R(u.current,t,a,o,n.signal)}catch(s){const c=document.getElementById("workspace-results");if(c){const l=s instanceof Error?s.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";c.innerHTML=`
                    <div class="error-state" role="alert" aria-live="assertive">
                        <div class="error-state__icon">âš ï¸</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--accent-danger);">ì‘ì—… ì‹¤íŒ¨</h3>
                        <p class="error-state__text">${l}</p>
                        <button id="retry-btn" class="retry-btn">
                            ğŸ”„ ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;const i=document.getElementById("retry-btn");i&&(i.addEventListener("click",()=>{document.getElementById("execute-btn")?.click()}),setTimeout(()=>i.focus(),100))}}finally{e=!1,E(r,!1)}})}export{F as initWorkspace};
//# sourceMappingURL=workspace.QykzNiY-.js.map
