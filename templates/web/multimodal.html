{% extends "layout.html" %}

{% block content %}
<div class="split-layout">
    <!-- ì™¼ìª½: ì—…ë¡œë“œ ì˜ì—­ -->
    <div class="left-panel">
        <h2>ğŸ–¼ï¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
        
        <div id="drop-zone" class="drop-zone">
            <p>ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
            <input type="file" id="file-input" accept="image/*" style="display:none">
        </div>

        <button id="analyze-btn" class="btn-primary" disabled>ğŸ” ë¶„ì„ ì‹¤í–‰</button>

        <div id="preview-area"></div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë¶„ì„ ê²°ê³¼ -->
    <div class="right-panel">
        <h2>ğŸ“Š ë¶„ì„ ê²°ê³¼</h2>
        <div id="analysis-results" class="results-area"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let selectedFile = null;

    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const analyzeBtn = document.getElementById('analyze-btn');

    // í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ
    dropZone.addEventListener('click', () => fileInput.click());

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#4CAF50';
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.style.borderColor = '#666';
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#666';
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFile(files[0]);
        }
    });

    // íŒŒì¼ ì„ íƒ
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFile(e.target.files[0]);
        }
    });

    function handleFile(file) {
        if (!file.type.startsWith('image/')) {
            alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            return;
        }

        selectedFile = file;
        analyzeBtn.disabled = false;

        // ë¯¸ë¦¬ë³´ê¸° - DOM methodë¡œ ì•ˆì „í•˜ê²Œ ìƒì„±
        const reader = new FileReader();
        reader.onload = (e) => {
            const previewArea = document.getElementById('preview-area');
            previewArea.innerHTML = '';
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.cssText = 'max-width:100%; margin-top:10px;';
            previewArea.appendChild(img);
        };
        reader.readAsDataURL(file);
    }

    // ë¶„ì„ ì‹¤í–‰
    analyzeBtn.addEventListener('click', async () => {
        if (!selectedFile) return;
        await analyzeImage(selectedFile);
    });
</script>
{% endblock %}
