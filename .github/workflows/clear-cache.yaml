name: Clear All Caches
on:
  workflow_dispatch:
jobs:
  clear-cache:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read  # private 저장소 접근 권한 추가
    steps:
      - name: Delete all caches
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Fetching list of cache keys..."
          REPO="${{ github.repository }}"
          
          # 캐시 목록 가져오기
          cache_keys=$(gh cache list -R "$REPO" --limit 100 --json key --jq '.[].key')
          
          if [ -z "$cache_keys" ]; then
            echo "No caches found."
            exit 0
          fi
          
          # 각 캐시 삭제
          echo "$cache_keys" | while read -r key; do
            if [ -n "$key" ]; then
              echo "Deleting cache: $key"
              gh cache delete "$key" -R "$REPO" --confirm || true
            fi
          done
          
          echo "Done! All caches cleared."
