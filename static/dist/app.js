const y=new Map,I=e=>new Promise(t=>setTimeout(t,e));function l(e,t="info"){const n=document.createElement("div");n.className=`toast toast--${t}`,n.textContent=e,document.body.appendChild(n),requestAnimationFrame(()=>n.classList.add("toast--show")),setTimeout(()=>{n.classList.remove("toast--show"),setTimeout(()=>n.remove(),300)},3e3)}class f extends Error{constructor(t,n={}){const a={400:"ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤",401:"ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤",403:"ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤",404:"ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",429:"ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”",500:"ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",502:"ê²Œì´íŠ¸ì›¨ì´ ì˜¤ë¥˜ì…ë‹ˆë‹¤",503:"ì„œë¹„ìŠ¤ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",504:"LLM ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”"}[t]||n.detail||n.message||"ìš”ì²­ ì‹¤íŒ¨";super(a),this.status=t,this.canRetry=[429,500,502,503,504].includes(t)}}function q(e){console.error("API Error:",e),e instanceof f&&e.canRetry?l(`${e.message} [ë‹¤ì‹œ ì‹œë„ ê°€ëŠ¥]`,"warning"):e instanceof Error?l(e.message,"error"):l("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.","error")}function T(){typeof window>"u"||(window.addEventListener("error",e=>{e.error?l(`ì˜¤ë¥˜: ${e.error.message}`,"error"):l("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.","error")}),window.addEventListener("unhandledrejection",e=>{const t=e.reason;t instanceof Error?l(`ì˜¤ë¥˜: ${t.message}`,"error"):l(typeof t=="string"?`ì˜¤ë¥˜: ${t}`:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.","error")}))}async function m(e,t="GET",n,r){const a={method:t,headers:{"Content-Type":"application/json"},signal:r};n&&(a.body=JSON.stringify(n));try{const o=await fetch(e,a);if(!o.ok){let s={};try{s=await o.json()}catch{}throw new f(o.status,s)}return await o.json()}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new Error("ìš”ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤"):(q(o),o)}}function B(e,t=null){navigator.clipboard.writeText(e).then(()=>{if(t){y.has(t)&&clearTimeout(y.get(t)),t.dataset.originalText||(t.dataset.originalText=t.textContent||""),t.textContent="âœ… ë³µì‚¬ë¨",t.classList.add("copied");const n=setTimeout(()=>{t.textContent=t.dataset.originalText||"",t.classList.remove("copied"),y.delete(t)},1500);y.set(t,n)}else l("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!","success")}).catch(n=>l("ë³µì‚¬ ì‹¤íŒ¨: "+n.message,"error"))}function L(e){const t=e==="batch"?9e4:45e3,n=Date.now(),r=setInterval(()=>{const a=Date.now()-n,o=Math.min(95,a/t*100),s=document.querySelector(".progress-fill");s&&(s.style.width=o+"%")},200);return()=>clearInterval(r)}async function k(e,t=2,n=500){let r=0,a=n,o;for(;r<=t;)try{return await e()}catch(s){o=s;const i=!s||s instanceof f&&s.canRetry||typeof s=="object"&&s!==null&&"status"in s&&typeof s.status=="number"&&s.status>=500;if(r===t||!i)break;await I(a),a*=2,r+=1}throw o}async function v(e="ocr-input"){const t=document.getElementById(e)||document.getElementById("ocr-preview");if(!t){console.error("OCR element not found");return}try{const r=(await m("/api/ocr")).ocr||"";t.tagName==="TEXTAREA"?(t.value=r,r||(t.placeholder="OCR íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”...")):(t.textContent=r||"OCR íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.",r||(t.style.color="#999"))}catch{t.tagName==="TEXTAREA"?(t.value="",t.placeholder="OCR ë¡œë“œ ì‹¤íŒ¨"):t.textContent="OCR ë¡œë“œ ì‹¤íŒ¨"}}async function w(e="ocr-input",t="ocr-save-status"){const n=document.getElementById(e);if(!n){console.error("OCR source not found");return}const r=document.getElementById(t);try{await m("/api/ocr","POST",{text:n.value}),r&&(r.textContent="âœ… ì €ì¥ë¨",r.className="status-text success",setTimeout(()=>r.textContent="",2e3))}catch(a){if(r)r.textContent="âŒ ì €ì¥ ì‹¤íŒ¨",r.className="status-text error";else{const o=a instanceof Error?a.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";l("OCR ì €ì¥ ì‹¤íŒ¨: "+o,"error")}}}let d=null;function C(e){return e==="batch"?{title:"âš¡ 4ê°œ íƒ€ì… ë™ì‹œ ìƒì„± ì¤‘...",eta:"30ì´ˆ~2ë¶„"}:e==="batch_three"?{title:"âš¡ 3ê°œ íƒ€ì… ë™ì‹œ ìƒì„± ì¤‘...",eta:"20ì´ˆ~90ì´ˆ"}:{title:"ğŸš€ ë‹µë³€ ìƒì„± ì¤‘...",eta:"15ì´ˆ~1ë¶„"}}function _(e){const{title:t,eta:n}=C(e);return`
        <div class="progress-container" style="text-align: center; padding: 40px 20px; background: var(--bg-secondary, #f5f5f5); border-radius: 8px;">
            <h3 style="margin-bottom: 20px; color: var(--text-primary, #333);">${t}</h3>
            <div style="margin: 25px auto; width: 320px; height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
                <div class="progress-fill" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary, #21808d) 0%, var(--primary-dark, #1a6673) 100%); transition: width 0.5s ease;"></div>
            </div>
            <p style="color: var(--text-secondary, #666); font-size: 0.95em; margin-top: 20px; font-weight: 500;">ì˜ˆìƒ ì†Œìš” ì‹œê°„: <strong>${n}</strong></p>
            <p style="color: var(--text-secondary, #666); font-size: 0.85em; margin-top: 8px;">ë³‘ë ¬ ì²˜ë¦¬ë¡œ ë¹ ë¥´ê²Œ ì™„ë£Œë©ë‹ˆë‹¤ âœ¨</p>
        </div>
    `}function b(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function A(e){const n=b(e).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\n\n/g,"<br><br>").replace(/\n/g,"<br>").replace(/^- /gm,"â€¢ ");return window.DOMPurify?window.DOMPurify.sanitize(n):n}function M(e){return{global_explanation:"ğŸŒ ì „ë°˜ ì„¤ëª…",reasoning:"ğŸ§  ì¶”ë¡ ",target_short:"ğŸ¯ íƒ€ê²Ÿ ë‹¨ë‹µ",target_long:"ğŸ“ íƒ€ê²Ÿ ì¥ë‹µ"}[e]||e}function S(e,t){sessionStorage.setItem("workspace_query",e),sessionStorage.setItem("workspace_answer",t),window.location.href="/workspace"}function O(e){if(!e||typeof e!="object")return!1;const t=e;return typeof t.type=="string"&&typeof t.query=="string"&&typeof t.answer=="string"}function $(e){var r,a;if(!e||typeof e!="object")return[];const t=e,n=[];return t.pairs&&n.push(...t.pairs),t.pair&&n.push(t.pair),(r=t.data)!=null&&r.pairs&&n.push(...t.data.pairs),(a=t.data)!=null&&a.pair&&n.push(t.data.pair),n.filter(O)}function H(e){var a;let t=$(e);const n=document.getElementById("results");if(!n)return;if(n.innerHTML="",((a=document.querySelector('input[name="mode"]:checked'))==null?void 0:a.value)==="batch_three"){const o=new Set(["global_explanation","reasoning","target_long"]);t=t.filter(s=>o.has(s.type))}if(!t.length){n.innerHTML=`
            <div class="qa-card">
                <p style="margin:0; color: var(--text-secondary, #666);">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        `;return}t.forEach((o,s)=>{const i=document.createElement("div");i.className="qa-card",i.style.animation=`slideIn 0.3s ease-out ${s*.05}s both`,i.innerHTML=`
            <div class="qa-header">
                <span class="qa-type-badge">${M(o.type)}</span>
            </div>
            <div class="qa-section">
                <strong>ğŸ’¬ ì§ˆì˜</strong>
                <div class="qa-content">${b(o.query)}</div>
            </div>
            <div class="qa-section">
                <strong>âœ¨ ë‹µë³€</strong>
                <div class="qa-content">${A(o.answer)}</div>
            </div>
            <div class="btn-row" style="margin-top: 15px;">
                <button class="btn-small qa-copy-btn">ğŸ“ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ë³µì‚¬</button>
            </div>
        `;const c=i.querySelector(".qa-copy-btn");c==null||c.addEventListener("click",()=>{S(o.query||"",o.answer||"")}),n.appendChild(i)})}async function R(e,t){const n=document.getElementById("results");if(!n)return;const a=document.getElementById("ocr-input").value;if(!a.trim()){l("OCR í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.","error");return}n.innerHTML=_(e);const o=L(e==="batch"||e==="batch_three"?"batch":"single"),s=document.querySelector(".progress-fill");try{const i=e==="single"?{mode:"single",ocr_text:a,qtype:t||"global_explanation"}:{mode:"batch",ocr_text:a};e==="batch_three"&&(i.batch_types=["global_explanation","reasoning","target_long"]),d&&d.abort(),d=new AbortController;const c=await k(()=>m("/api/qa/generate","POST",i,d.signal),2,800);d=null,o(),s&&(s.style.width="100%"),await new Promise(p=>setTimeout(p,300)),H(c)}catch(i){d=null,o();const c=i instanceof Error?i.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";n.innerHTML=`
            <div style="text-align: center; padding: 30px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;">
                <h3 style="color: #f44336; margin-bottom: 10px;">âŒ ìƒì„± ì‹¤íŒ¨</h3>
                <p style="color: #666; margin: 0;">${c}</p>
            </div>
        `}}function N(){var e,t;v(),(e=document.getElementById("save-ocr-btn"))==null||e.addEventListener("click",()=>w()),document.querySelectorAll('input[name="mode"]').forEach(n=>{n.addEventListener("change",r=>{const a=document.getElementById("type-selector");a&&(a.style.display=r.target.value==="single"?"block":"none")})}),(t=document.getElementById("generate-btn"))==null||t.addEventListener("click",async()=>{const n=document.querySelector('input[name="mode"]:checked'),r=(n==null?void 0:n.value)||"single",a=document.getElementById("qtype"),o=r==="single"?a.value:null;await R(r,o)}),document.addEventListener("keydown",n=>{n.key==="Escape"&&d&&(d.abort(),l("ìš”ì²­ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.","warning"))})}const g="workspace_global_explanation",u={current:"full",switchTo(e){this.current=e;const t=document.getElementById("query"),n=document.getElementById("answer"),r=document.getElementById("query-badge"),a=document.getElementById("answer-badge"),o=document.getElementById("query-help"),s=document.getElementById("answer-help"),i=document.getElementById("query-type-section"),c=document.getElementById("execute-btn");t.readOnly=!1,n.readOnly=!1,t.classList.remove("output-only","required-input"),n.classList.remove("output-only","required-input"),e==="full"?(r.textContent="ì„ íƒ",r.className="field-badge optional",a.textContent="ì„ íƒ",a.className="field-badge optional",o.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",s.textContent="ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤",t.placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",n.placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)",i.style.display="block",c.textContent="ğŸš€ ì‹¤í–‰"):e==="query-only"?(r.textContent="ìë™ ìƒì„±",r.className="field-badge output",a.textContent="í•„ìˆ˜ ì…ë ¥",a.className="field-badge required",o.innerHTML="ğŸ¤– <strong>ë‹µë³€ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",s.innerHTML="âœ… <strong>ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ì§ˆë¬¸ ìƒì„±)",t.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì§ˆë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤",n.placeholder="ì§ˆë¬¸ì„ ìƒì„±í•  ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”",t.readOnly=!0,t.classList.add("output-only"),n.classList.add("required-input"),i.style.display="none",c.textContent="â“ ì§ˆë¬¸ ìƒì„±"):e==="answer-only"&&(r.textContent="í•„ìˆ˜ ì…ë ¥",r.className="field-badge required",a.textContent="ìë™ ìƒì„±",a.className="field-badge output",o.innerHTML="âœ… <strong>ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ë‹µë³€ ìƒì„±)",s.innerHTML="ğŸ¤– <strong>ì§ˆë¬¸ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>",t.placeholder="ë‹µë³€ì„ ìƒì„±í•  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",n.placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ë‹µë³€ì´ í‘œì‹œë©ë‹ˆë‹¤",n.readOnly=!0,n.classList.add("output-only"),t.classList.add("required-input"),i.style.display="block",c.textContent="ğŸ’¡ ë‹µë³€ ìƒì„±"),this.updateValidation()},updateValidation(){const e=document.getElementById("query").value.trim(),t=document.getElementById("answer").value.trim(),n=document.getElementById("ocr-input").value.trim(),r=document.getElementById("global-explanation-ref").value.trim(),a=document.getElementById("execute-btn");let o=!1;this.current==="query-only"?o=!!(t||n):this.current==="answer-only"?o=!!e:o=!!(n||r||e||t),a.disabled=!o,a.style.opacity=o?"1":"0.6"}};function h(e,t){e&&(e.disabled=t,e.setAttribute("aria-busy",String(t)),t?(e.dataset.originalText=e.dataset.originalText||e.textContent||"",e.setAttribute("aria-label","ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),e.textContent="â³ ì²˜ë¦¬ ì¤‘...",e.style.opacity="0.6"):(e.textContent=e.dataset.originalText||e.textContent,e.setAttribute("aria-label","ì‹¤í–‰"),e.style.opacity="1",e.removeAttribute("aria-busy")))}function x(e){e.style.borderColor="var(--primary, #21808d)",e.style.boxShadow="0 0 0 3px rgba(33, 128, 141, 0.2)",setTimeout(()=>{e.style.borderColor="",e.style.boxShadow=""},2e3)}function P(e){return{full_generation:"ğŸ¯ ì „ì²´ ìƒì„±",query_generation:"â“ ì§ˆì˜ ìƒì„±",answer_generation:"ğŸ’¡ ë‹µë³€ ìƒì„±",edit_query:"âœï¸ ì§ˆì˜ ìˆ˜ì •",edit_answer:"âœï¸ ë‹µë³€ ìˆ˜ì •",edit_both:"âœï¸ ì§ˆì˜+ë‹µë³€ ìˆ˜ì •",rewrite:"âœ… ì¬ì‘ì„±/ê²€ìˆ˜"}[e]||e}function D(e){const t=u.current,n=["full_generation","query_generation","edit_query","edit_both"].includes(e.workflow);if(e.query&&t!=="answer-only"&&n){const a=document.getElementById("query");a.value=e.query,x(a)}if(e.answer){const a=document.getElementById("answer");a.value=e.answer,x(a)}const r=document.getElementById("workspace-results");r&&(r.innerHTML=`
        <div style="text-align: center; padding: 20px; background: #e8f5e9; border-radius: 8px; border: 1px solid #4caf50; margin-top: 20px; animation: fadeIn 0.3s;">
            <h3 style="margin: 0 0 10px 0; color: #4caf50;">âœ… ${P(e.workflow)} ì™„ë£Œ</h3>
            <p style="margin: 0; color: #666; font-size: 0.9em;">
                ${e.query?"ì§ˆì˜":""}${e.query&&e.answer?"ì™€ ":""}${e.answer?"ë‹µë³€":""}ì´ ì…ë ¥ í•„ë“œì— ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.
            </p>
        </div>
    `,setTimeout(()=>{r.innerHTML=""},3e3))}function V(e,t){const r=document.getElementById(e).value.trim();if(!r){l("ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.","error");return}B(r,t)}function j(){const e=sessionStorage.getItem("workspace_query"),t=sessionStorage.getItem("workspace_answer");e&&(document.getElementById("query").value=e,sessionStorage.removeItem("workspace_query")),t&&(document.getElementById("answer").value=t,sessionStorage.removeItem("workspace_answer"))}function F(){const e=localStorage.getItem(g);e&&(document.getElementById("global-explanation-ref").value=e)}function W(){var n;let e;const t=document.getElementById("global-explanation-ref");t.addEventListener("input",r=>{clearTimeout(e);const a=r.target.value;e=setTimeout(()=>{localStorage.setItem(g,a)},300)}),(n=document.getElementById("clear-reference-btn"))==null||n.addEventListener("click",()=>{t.value="",localStorage.removeItem(g)})}function Q(){const e=document.querySelectorAll(".workspace-mode-tabs .mode-tab");e.forEach(t=>{const n=t;n.addEventListener("click",()=>{e.forEach(r=>r.classList.remove("active")),n.classList.add("active"),n.dataset.mode&&u.switchTo(n.dataset.mode)}),n.addEventListener("keydown",r=>{const a=Array.from(e).indexOf(n);let o=a;r.key==="ArrowRight"&&(o=(a+1)%e.length),r.key==="ArrowLeft"&&(o=(a-1+e.length)%e.length),r.key==="Home"&&(o=0),r.key==="End"&&(o=e.length-1),o!==a&&(r.preventDefault(),e[o].click(),e[o].focus())})})}function z(){let e;const t=()=>{clearTimeout(e),e=setTimeout(()=>u.updateValidation(),150)};["query","answer","ocr-input","global-explanation-ref"].forEach(n=>{const r=document.getElementById(n);r&&r.addEventListener("input",t)})}async function G(e,t,n,r,a){const o=document.getElementById("workspace-results");if(!o)return;o.innerHTML=`
        <div style="text-align: center; padding: 20px; background: var(--bg-secondary, #f5f5f5); border-radius: 8px; margin-top: 20px;">
            <p style="color: var(--text-primary, #1f2121); margin: 0;">â³ ì²˜ë¦¬ ì¤‘...</p>
        </div>
    `;const s={mode:e,query:t||null,answer:n||null,edit_request:r||null,ocr_text:document.getElementById("ocr-input").value||null,query_type:document.getElementById("query-type").value||null,global_explanation_ref:document.getElementById("global-explanation-ref").value.trim()||null};e==="query-only"&&!r?s.query=null:e==="answer-only"&&!r&&(s.answer=null);const i=await m("/api/workspace/unified","POST",s,a);D(i)}function X(){var n,r;v(),(n=document.getElementById("save-ocr-btn"))==null||n.addEventListener("click",()=>w()),j(),F(),W(),Q(),z(),u.switchTo("full"),document.querySelectorAll("[data-copy-target]").forEach(a=>{const o=a;o.addEventListener("click",()=>{o.dataset.copyTarget&&V(o.dataset.copyTarget,o)})});let e=!1,t=null;(r=document.getElementById("execute-btn"))==null||r.addEventListener("click",async()=>{if(e)return;t&&t.abort(),t=new AbortController;const a=document.getElementById("execute-btn");e=!0,h(a,!0);const o=document.getElementById("query").value.trim(),s=document.getElementById("answer").value.trim(),i=document.getElementById("edit-request").value.trim();try{await G(u.current,o,s,i,t.signal)}catch(c){const p=document.getElementById("workspace-results");if(p){const E=c instanceof Error?c.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";p.innerHTML=`
                    <div style="text-align: center; padding: 20px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;">
                        <p style="color: #f44336; margin: 0;">âŒ ì‘ì—… ì‹¤íŒ¨: ${E}</p>
                    </div>
                `}}finally{e=!1,h(a,!1)}})}function J(){var e,t;v(),(e=document.getElementById("save-ocr-btn"))==null||e.addEventListener("click",()=>w()),(t=document.getElementById("eval-btn"))==null||t.addEventListener("click",async()=>{const n=document.getElementById("query").value,r=[document.getElementById("answer-a").value,document.getElementById("answer-b").value,document.getElementById("answer-c").value];if(!n||r.some(a=>!a.trim())){l("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.","error");return}await K(n,r)})}async function K(e,t){const n=document.getElementById("eval-results");if(n){n.innerHTML='<div class="loading"></div> ì²˜ë¦¬ ì¤‘...';try{const r=await m("/api/eval/external","POST",{query:e,answers:t});n.innerHTML="<h3>í‰ê°€ ê²°ê³¼</h3>";const a=document.createElement("table");a.innerHTML=`
            <thead>
                <tr>
                    <th>ë‹µë³€</th>
                    <th>ì ìˆ˜</th>
                    <th>í”¼ë“œë°±</th>
                </tr>
            </thead>
            <tbody>
                ${r.results.map(o=>`
                    <tr class="${o.candidate_id===r.best?"best-answer":""}">
                        <td>${o.candidate_id} ${o.candidate_id===r.best?"â­":""}</td>
                        <td>${o.score}</td>
                        <td>${o.feedback}</td>
                    </tr>
                `).join("")}
            </tbody>
        `,n.appendChild(a)}catch(r){const a=r instanceof Error?r.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";n.innerHTML=`<p style="color: var(--danger)">í‰ê°€ ì‹¤íŒ¨: ${a}</p>`}}}document.addEventListener("DOMContentLoaded",()=>{T();const e=window.location.pathname;e==="/qa"?N():e==="/workspace"?X():e==="/eval"&&J()});
//# sourceMappingURL=app.js.map
