{"version":3,"file":"app.js","sources":["../utils.ts","../ocr.ts","../qa.ts","../workspace.ts","../eval.ts","../app.ts"],"sourcesContent":["// ê³µí†µ ìœ í‹¸ í•¨ìˆ˜ ëª¨ìŒ\r\n\r\nconst copyTimeouts = new Map<HTMLElement, number>();\r\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\nexport type ToastType = \"info\" | \"success\" | \"warning\" | \"error\";\r\n\r\nexport function showToast(message: string, type: ToastType = \"info\"): void {\r\n    const toast = document.createElement(\"div\");\r\n    toast.className = `toast toast--${type}`;\r\n    toast.textContent = message;\r\n    document.body.appendChild(toast);\r\n\r\n    requestAnimationFrame(() => toast.classList.add(\"toast--show\"));\r\n    setTimeout(() => {\r\n        toast.classList.remove(\"toast--show\");\r\n        setTimeout(() => toast.remove(), 300);\r\n    }, 3000);\r\n}\r\n\r\nexport interface ApiErrorData {\n    detail?: string;\n    message?: string;\n    [key: string]: unknown;\n}\n\r\nexport class ApiError extends Error {\r\n    status: number;\r\n    canRetry: boolean;\r\n\r\n    constructor(status: number, errorData: ApiErrorData = {}) {\r\n        const messages: Record<number, string> = {\r\n            400: \"ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤\",\r\n            401: \"ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤\",\r\n            403: \"ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤\",\r\n            404: \"ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\",\r\n            429: \"ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”\",\r\n            500: \"ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\",\r\n            502: \"ê²Œì´íŠ¸ì›¨ì´ ì˜¤ë¥˜ì…ë‹ˆë‹¤\",\r\n            503: \"ì„œë¹„ìŠ¤ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤\",\r\n            504: \"LLM ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”\",\r\n        };\r\n\r\n        const detail =\r\n            messages[status] ||\r\n            errorData.detail ||\r\n            errorData.message ||\r\n            \"ìš”ì²­ ì‹¤íŒ¨\";\r\n        super(detail);\r\n        this.status = status;\r\n        this.canRetry = [429, 500, 502, 503, 504].includes(status);\r\n    }\r\n}\r\n\r\nfunction handleApiError(error: unknown): void {\n    console.error(\"API Error:\", error);\n    if (error instanceof ApiError && error.canRetry) {\n        showToast(`${error.message} [ë‹¤ì‹œ ì‹œë„ ê°€ëŠ¥]`, \"warning\");\n    } else if (error instanceof Error) {\n        showToast(error.message, \"error\");\n    } else {\n        showToast(\"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\", \"error\");\n    }\n}\n\nexport async function apiCall<T = unknown>(\n    url: string,\n    method: string = \"GET\",\n    body?: unknown,\n    signal?: AbortSignal\n): Promise<T> {\n    const options: RequestInit = {\r\n        method,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        signal,\r\n    };\r\n    if (body) {\r\n        options.body = JSON.stringify(body);\r\n    }\r\n    try {\r\n        const response = await fetch(url, options);\r\n        if (!response.ok) {\r\n            let errorData: ApiErrorData = {};\r\n            try {\r\n                errorData = await response.json();\r\n            } catch {\r\n                // ignore parse error\r\n            }\r\n            throw new ApiError(response.status, errorData);\r\n        }\r\n        return await response.json();\r\n    } catch (error: unknown) {\n        if (error instanceof DOMException && error.name === \"AbortError\") {\n            throw new Error(\"ìš”ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤\");\n        }\n        handleApiError(error);\n        throw error;\n    }\n}\r\n\r\nexport function showLoading(elementId: string): void {\r\n    const el = document.getElementById(elementId);\r\n    if (!el) return;\r\n    el.innerHTML = '<div class=\"loading\"></div> ì²˜ë¦¬ ì¤‘...';\r\n}\r\n\r\nexport function copyToClipboard(text: string, buttonEl: HTMLElement | null = null): void {\r\n    navigator.clipboard\r\n        .writeText(text)\r\n        .then(() => {\r\n            if (buttonEl) {\r\n                if (copyTimeouts.has(buttonEl)) {\r\n                    clearTimeout(copyTimeouts.get(buttonEl)!);\r\n                }\r\n                if (!buttonEl.dataset.originalText) {\r\n                    buttonEl.dataset.originalText = buttonEl.textContent || \"\";\r\n                }\r\n                buttonEl.textContent = \"âœ… ë³µì‚¬ë¨\";\r\n                buttonEl.classList.add(\"copied\");\r\n                const timeout = setTimeout(() => {\r\n                    buttonEl.textContent = buttonEl.dataset.originalText || \"\";\r\n                    buttonEl.classList.remove(\"copied\");\r\n                    copyTimeouts.delete(buttonEl);\r\n                }, 1500);\r\n                copyTimeouts.set(buttonEl, timeout);\r\n            } else {\r\n                showToast(\"í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\", \"success\");\r\n            }\r\n        })\r\n        .catch((err) => showToast(\"ë³µì‚¬ ì‹¤íŒ¨: \" + err.message, \"error\"));\r\n}\r\n\r\nexport interface SSEParseResult {\n    events: unknown[];\n    remainder: string;\n}\n\n// SSE ë²„í¼ íŒŒì„œ (ë¶ˆì™„ì „ ì²­í¬ ì²˜ë¦¬)\nexport function parseSSEBuffer(buffer: string): SSEParseResult {\n    const events: unknown[] = [];\n    let startIdx = 0;\r\n\r\n    while (true) {\r\n        const dataIdx = buffer.indexOf(\"data:\", startIdx);\r\n        if (dataIdx === -1) break;\r\n        const endIdx = buffer.indexOf(\"\\n\\n\", dataIdx);\r\n        if (endIdx === -1) {\r\n            return { events, remainder: buffer.slice(startIdx) };\r\n        }\r\n        const payload = buffer.slice(dataIdx + 5, endIdx).trim();\r\n        try {\r\n            events.push(JSON.parse(payload));\r\n        } catch (e) {\r\n            console.warn(\"Failed to parse SSE chunk:\", payload, e);\r\n        }\r\n        startIdx = endIdx + 2;\r\n    }\r\n    return { events, remainder: \"\" };\r\n}\r\n\r\n// ì§„í–‰ë¥  ì¶”ì • í—¬í¼\r\nexport function showProgressWithEstimate(mode: \"batch\" | \"single\"): () => void {\r\n    const estimatedTime = mode === \"batch\" ? 90000 : 45000; // ms\r\n    const startTime = Date.now();\r\n    const progressInterval = setInterval(() => {\r\n        const elapsed = Date.now() - startTime;\r\n        const progress = Math.min(95, (elapsed / estimatedTime) * 100);\r\n        const bar = document.querySelector(\".progress-fill\") as HTMLElement;\r\n        if (bar) bar.style.width = progress + \"%\";\r\n    }, 200);\r\n    return () => clearInterval(progressInterval);\r\n}\r\n\r\nexport async function withRetry<T>(\n    fn: () => Promise<T>,\n    retries: number = 2,\n    initialDelayMs: number = 500\n): Promise<T> {\n    let attempt = 0;\r\n    let delay = initialDelayMs;\r\n    let lastError: unknown;\n    while (attempt <= retries) {\n        try {\n            return await fn();\n        } catch (err: unknown) {\n            lastError = err;\n            const retryable =\n                !err ||\n                (err instanceof ApiError && err.canRetry) ||\n                (typeof err === \"object\" &&\n                    err !== null &&\n                    \"status\" in err &&\n                    typeof (err as { status?: number }).status === \"number\" &&\n                    (err as { status: number }).status >= 500);\n            if (attempt === retries || !retryable) {\r\n                break;\r\n            }\r\n            await sleep(delay);\r\n            delay *= 2;\r\n            attempt += 1;\r\n        }\r\n    }\r\n    throw lastError;\r\n}\r\n","import { apiCall, showToast } from \"./utils.js\";\r\n\r\ninterface OcrResponse {\n    ocr?: string;\n}\n\r\nexport async function loadOCR(targetId: string = \"ocr-input\"): Promise<void> {\r\n    const input =\r\n        document.getElementById(targetId) ||\r\n        document.getElementById(\"ocr-preview\");\r\n    if (!input) {\r\n        console.error(\"OCR element not found\");\r\n        return;\r\n    }\r\n    try {\r\n        const data = await apiCall<OcrResponse>(\"/api/ocr\");\r\n        const value = data.ocr || \"\";\r\n        if (input.tagName === \"TEXTAREA\") {\r\n            (input as HTMLTextAreaElement).value = value;\r\n            if (!value) {\r\n                (input as HTMLTextAreaElement).placeholder = \"OCR íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”...\";\r\n            }\r\n        } else {\r\n            input.textContent = value || \"OCR íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.\";\r\n            if (!value) input.style.color = \"#999\";\r\n        }\r\n    } catch (error: unknown) {\n        if (input.tagName === \"TEXTAREA\") {\n            (input as HTMLTextAreaElement).value = \"\";\n            (input as HTMLTextAreaElement).placeholder = \"OCR ë¡œë“œ ì‹¤íŒ¨\";\n        } else {\r\n            input.textContent = \"OCR ë¡œë“œ ì‹¤íŒ¨\";\r\n        }\r\n    }\r\n}\r\n\r\nexport async function saveOCR(sourceId: string = \"ocr-input\", statusId: string = \"ocr-save-status\"): Promise<void> {\r\n    const input = document.getElementById(sourceId) as HTMLTextAreaElement;\r\n    if (!input) {\r\n        console.error(\"OCR source not found\");\r\n        return;\r\n    }\r\n    const statusEl = document.getElementById(statusId);\r\n    try {\r\n        await apiCall(\"/api/ocr\", \"POST\", { text: input.value });\r\n        if (statusEl) {\r\n            statusEl.textContent = \"âœ… ì €ì¥ë¨\";\r\n            statusEl.className = \"status-text success\";\r\n            setTimeout(() => (statusEl.textContent = \"\"), 2000);\r\n        }\r\n    } catch (error: unknown) {\n        if (statusEl) {\n            statusEl.textContent = \"âŒ ì €ì¥ ì‹¤íŒ¨\";\n            statusEl.className = \"status-text error\";\n        } else {\n            const message =\n                error instanceof Error ? error.message : \"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\";\n            showToast(\"OCR ì €ì¥ ì‹¤íŒ¨: \" + message, \"error\");\n        }\n    }\n}\n","import { apiCall, showToast, showProgressWithEstimate, withRetry } from \"./utils.js\";\r\nimport { loadOCR, saveOCR } from \"./ocr.js\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        DOMPurify: {\r\n            sanitize: (text: string) => string;\r\n        };\r\n    }\r\n}\r\n\r\ninterface QAPair {\r\n    type: string;\r\n    query: string;\r\n    answer: string;\r\n}\r\n\r\ninterface QAData {\r\n    success?: boolean;\r\n    data?: {\r\n        pairs?: QAPair[];\r\n        pair?: QAPair;\r\n    };\r\n    pairs?: QAPair[]; // flatten access\r\n    pair?: QAPair;\r\n}\r\n\r\nlet activeController: AbortController | null = null;\r\n\r\nfunction getModeLabels(mode: string): { title: string; eta: string } {\r\n    if (mode === \"batch\") {\r\n        return { title: \"âš¡ 4ê°œ íƒ€ì… ë™ì‹œ ìƒì„± ì¤‘...\", eta: \"30ì´ˆ~2ë¶„\" };\r\n    }\r\n    if (mode === \"batch_three\") {\r\n        return { title: \"âš¡ 3ê°œ íƒ€ì… ë™ì‹œ ìƒì„± ì¤‘...\", eta: \"20ì´ˆ~90ì´ˆ\" };\r\n    }\r\n    return { title: \"ğŸš€ ë‹µë³€ ìƒì„± ì¤‘...\", eta: \"15ì´ˆ~1ë¶„\" };\r\n}\r\n\r\nfunction renderProgress(mode: string): string {\r\n    const { title, eta } = getModeLabels(mode);\r\n    return `\r\n        <div class=\"progress-container\" style=\"text-align: center; padding: 40px 20px; background: var(--bg-secondary, #f5f5f5); border-radius: 8px;\">\r\n            <h3 style=\"margin-bottom: 20px; color: var(--text-primary, #333);\">${title}</h3>\r\n            <div style=\"margin: 25px auto; width: 320px; height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);\">\r\n                <div class=\"progress-fill\" style=\"width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary, #21808d) 0%, var(--primary-dark, #1a6673) 100%); transition: width 0.5s ease;\"></div>\r\n            </div>\r\n            <p style=\"color: var(--text-secondary, #666); font-size: 0.95em; margin-top: 20px; font-weight: 500;\">ì˜ˆìƒ ì†Œìš” ì‹œê°„: <strong>${eta}</strong></p>\r\n            <p style=\"color: var(--text-secondary, #666); font-size: 0.85em; margin-top: 8px;\">ë³‘ë ¬ ì²˜ë¦¬ë¡œ ë¹ ë¥´ê²Œ ì™„ë£Œë©ë‹ˆë‹¤ âœ¨</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n    const div = document.createElement(\"div\");\r\n    div.textContent = text || \"\";\r\n    return div.innerHTML;\r\n}\r\n\r\nfunction formatAnswer(text: string): string {\r\n    const escaped = escapeHtml(text);\r\n    const formatted = escaped\r\n        .replace(/\\*\\*([^*]+)\\*\\*/g, \"<strong>$1</strong>\")\r\n        .replace(/\\n\\n/g, \"<br><br>\")\r\n        .replace(/\\n/g, \"<br>\")\r\n        .replace(/^- /gm, \"â€¢ \");\r\n    // DOMPurify is loaded globally\r\n    return window.DOMPurify ? window.DOMPurify.sanitize(formatted) : formatted;\r\n}\r\n\r\nfunction getTypeBadge(type: string): string {\r\n    const badges: Record<string, string> = {\r\n        global_explanation: \"ğŸŒ ì „ë°˜ ì„¤ëª…\",\r\n        reasoning: \"ğŸ§  ì¶”ë¡ \",\r\n        target_short: \"ğŸ¯ íƒ€ê²Ÿ ë‹¨ë‹µ\",\r\n        target_long: \"ğŸ“ íƒ€ê²Ÿ ì¥ë‹µ\",\r\n    };\r\n    return badges[type] || type;\r\n}\r\n\r\nfunction copyToWorkspace(query: string, answer: string): void {\r\n    sessionStorage.setItem(\"workspace_query\", query);\r\n    sessionStorage.setItem(\"workspace_answer\", answer);\r\n    window.location.href = \"/workspace\";\r\n}\r\n\r\nfunction isQAPair(value: unknown): value is QAPair {\n    if (!value || typeof value !== \"object\") return false;\n    const candidate = value as Record<string, unknown>;\n    return (\n        typeof candidate.type === \"string\" &&\n        typeof candidate.query === \"string\" &&\n        typeof candidate.answer === \"string\"\n    );\n}\n\nfunction extractPairs(raw: unknown): QAPair[] {\n    if (!raw || typeof raw !== \"object\") return [];\n\n    const payload = raw as QAData;\n    const candidates: unknown[] = [];\n\n    if (payload.pairs) candidates.push(...payload.pairs);\n    if (payload.pair) candidates.push(payload.pair);\n    if (payload.data?.pairs) candidates.push(...payload.data.pairs);\n    if (payload.data?.pair) candidates.push(payload.data.pair);\n\n    return candidates.filter(isQAPair);\n}\n\nfunction displayResults(raw: unknown): void {\n    let pairs = extractPairs(raw);\n    const resultsDiv = document.getElementById(\"results\");\n    if (!resultsDiv) return;\n    resultsDiv.innerHTML = \"\";\n\n    const selectedMode = (document.querySelector(\"input[name=\\\"mode\\\"]:checked\") as HTMLInputElement)?.value;\n    if (selectedMode === \"batch_three\") {\r\n        const allowed = new Set([\"global_explanation\", \"reasoning\", \"target_long\"]);\r\n        pairs = pairs.filter((p) => allowed.has(p.type));\r\n    }\r\n    if (!pairs.length) {\r\n        resultsDiv.innerHTML = `\r\n            <div class=\"qa-card\">\r\n                <p style=\"margin:0; color: var(--text-secondary, #666);\">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n\r\n    pairs.forEach((item, index) => {\r\n        const card = document.createElement(\"div\");\r\n        card.className = \"qa-card\";\r\n        card.style.animation = `slideIn 0.3s ease-out ${index * 0.05}s both`;\r\n\r\n        card.innerHTML = `\r\n            <div class=\"qa-header\">\r\n                <span class=\"qa-type-badge\">${getTypeBadge(item.type)}</span>\r\n            </div>\r\n            <div class=\"qa-section\">\r\n                <strong>ğŸ’¬ ì§ˆì˜</strong>\r\n                <div class=\"qa-content\">${escapeHtml(item.query)}</div>\r\n            </div>\r\n            <div class=\"qa-section\">\r\n                <strong>âœ¨ ë‹µë³€</strong>\r\n                <div class=\"qa-content\">${formatAnswer(item.answer)}</div>\r\n            </div>\r\n            <div class=\"btn-row\" style=\"margin-top: 15px;\">\r\n                <button class=\"btn-small qa-copy-btn\">ğŸ“ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ë³µì‚¬</button>\r\n            </div>\r\n        `;\r\n\r\n        const copyBtn = card.querySelector(\".qa-copy-btn\");\r\n        copyBtn?.addEventListener(\"click\", () => {\r\n            copyToWorkspace(item.query || \"\", item.answer || \"\");\r\n        });\r\n\r\n        resultsDiv.appendChild(card);\r\n    });\r\n}\r\n\r\ntype GenerateMode = \"single\" | \"batch\" | \"batch_three\";\n\ninterface GeneratePayload {\n    mode: \"single\" | \"batch\";\n    ocr_text: string;\n    qtype?: string;\n    batch_types?: string[];\n}\n\nasync function generateQA(mode: GenerateMode, qtype: string | null): Promise<void> {\n    const resultsDiv = document.getElementById(\"results\");\r\n    if (!resultsDiv) return;\r\n    const ocrInput = document.getElementById(\"ocr-input\") as HTMLTextAreaElement;\r\n    const ocrText = ocrInput.value;\r\n\r\n    if (!ocrText.trim()) {\r\n        showToast(\"OCR í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.\", \"error\");\r\n        return;\r\n    }\r\n\r\n    resultsDiv.innerHTML = renderProgress(mode);\r\n    const stopProgress = showProgressWithEstimate(mode === \"batch\" || mode === \"batch_three\" ? \"batch\" : \"single\");\r\n    const progressBar = document.querySelector(\".progress-fill\") as HTMLElement;\r\n\r\n    try {\n        const payload: GeneratePayload =\n            mode === \"single\"\n                ? {\n                      mode: \"single\",\n                      ocr_text: ocrText,\n                      qtype: qtype || \"global_explanation\",\n                  }\n                : {\n                      mode: \"batch\",\n                      ocr_text: ocrText,\n                  };\n\n        if (mode === \"batch_three\") {\n            payload.batch_types = [\n                \"global_explanation\",\n                \"reasoning\",\n                \"target_long\",\n            ];\n        }\n\r\n        if (activeController) {\r\n            activeController.abort();\r\n        }\r\n        activeController = new AbortController();\r\n        const result = await withRetry(\r\n            () => apiCall<QAData>(\"/api/qa/generate\", \"POST\", payload, activeController!.signal),\n            2,\n            800,\n        );\n        activeController = null;\r\n        stopProgress();\r\n        if (progressBar) progressBar.style.width = \"100%\";\r\n        await new Promise((resolve) => setTimeout(resolve, 300));\r\n        displayResults(result);\r\n    } catch (error: unknown) {\n        activeController = null;\n        stopProgress();\n        const message =\n            error instanceof Error ? error.message : \"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\";\n        resultsDiv.innerHTML = `\n            <div style=\"text-align: center; padding: 30px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;\">\n                <h3 style=\"color: #f44336; margin-bottom: 10px;\">âŒ ìƒì„± ì‹¤íŒ¨</h3>\n                <p style=\"color: #666; margin: 0;\">${message}</p>\n            </div>\n        `;\n    }\n}\r\n\r\nexport function initQA(): void {\r\n    loadOCR();\r\n    document.getElementById(\"save-ocr-btn\")?.addEventListener(\"click\", () => saveOCR());\r\n\r\n    document.querySelectorAll(\"input[name=\\\"mode\\\"]\").forEach((radio) => {\r\n        radio.addEventListener(\"change\", (e) => {\r\n            const selector = document.getElementById(\"type-selector\");\r\n            if (selector) {\r\n                selector.style.display = (e.target as HTMLInputElement).value === \"single\" ? \"block\" : \"none\";\r\n            }\r\n        });\r\n    });\r\n\r\n    document.getElementById(\"generate-btn\")?.addEventListener(\"click\", async () => {\r\n        const modeInput = document.querySelector(\"input[name=\\\"mode\\\"]:checked\") as HTMLInputElement;\n        const mode = (modeInput?.value || \"single\") as GenerateMode;\n        const qtypeInput = document.getElementById(\"qtype\") as HTMLSelectElement;\n        const qtype = mode === \"single\" ? qtypeInput.value : null;\n        await generateQA(mode, qtype);\n    });\r\n\r\n    document.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Escape\" && activeController) {\r\n            activeController.abort();\r\n            showToast(\"ìš”ì²­ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.\", \"warning\");\r\n        }\r\n    });\r\n}\r\n","import { apiCall, copyToClipboard, showToast } from \"./utils.js\";\r\nimport { loadOCR, saveOCR } from \"./ocr.js\";\r\n\r\nconst GLOBAL_EXPLANATION_KEY = \"workspace_global_explanation\";\r\n\r\ninterface WorkspaceMode {\r\n    current: \"full\" | \"query-only\" | \"answer-only\";\r\n    switchTo(mode: string): void;\r\n    updateValidation(): void;\r\n}\r\n\r\ninterface WorkspaceResult {\r\n    workflow: string;\r\n    query?: string;\r\n    answer?: string;\r\n}\r\n\r\ninterface WorkspacePayload {\r\n    mode: string;\r\n    query: string | null;\r\n    answer: string | null;\r\n    edit_request: string | null;\r\n    ocr_text: string | null;\r\n    query_type: string | null;\r\n    global_explanation_ref: string | null;\r\n}\r\n\r\nconst WorkspaceMode: WorkspaceMode = {\r\n    current: \"full\",\r\n    switchTo(mode: string) {\r\n        this.current = mode as \"full\" | \"query-only\" | \"answer-only\";\r\n        const queryField = document.getElementById(\"query\") as HTMLTextAreaElement;\r\n        const answerField = document.getElementById(\"answer\") as HTMLTextAreaElement;\r\n        const queryBadge = document.getElementById(\"query-badge\") as HTMLElement;\r\n        const answerBadge = document.getElementById(\"answer-badge\") as HTMLElement;\r\n        const queryHelp = document.getElementById(\"query-help\") as HTMLElement;\r\n        const answerHelp = document.getElementById(\"answer-help\") as HTMLElement;\r\n        const queryTypeSection = document.getElementById(\"query-type-section\") as HTMLElement;\r\n        const executeBtn = document.getElementById(\"execute-btn\") as HTMLButtonElement;\r\n\r\n        queryField.readOnly = false;\r\n        answerField.readOnly = false;\r\n        queryField.classList.remove(\"output-only\", \"required-input\");\r\n        answerField.classList.remove(\"output-only\", \"required-input\");\r\n\r\n        if (mode === \"full\") {\r\n            queryBadge.textContent = \"ì„ íƒ\";\r\n            queryBadge.className = \"field-badge optional\";\r\n            answerBadge.textContent = \"ì„ íƒ\";\r\n            answerBadge.className = \"field-badge optional\";\r\n            queryHelp.textContent = \"ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤\";\r\n            answerHelp.textContent = \"ğŸ’¡ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤\";\r\n            queryField.placeholder = \"ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)\";\r\n            answerField.placeholder = \"ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ìë™ ìƒì„±)\";\r\n            queryTypeSection.style.display = \"block\";\r\n            executeBtn.textContent = \"ğŸš€ ì‹¤í–‰\";\r\n        } else if (mode === \"query-only\") {\r\n            queryBadge.textContent = \"ìë™ ìƒì„±\";\r\n            queryBadge.className = \"field-badge output\";\r\n            answerBadge.textContent = \"í•„ìˆ˜ ì…ë ¥\";\r\n            answerBadge.className = \"field-badge required\";\r\n            queryHelp.innerHTML = \"ğŸ¤– <strong>ë‹µë³€ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>\";\r\n            answerHelp.innerHTML = \"âœ… <strong>ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ì§ˆë¬¸ ìƒì„±)\";\r\n            queryField.placeholder = \"ì—¬ê¸°ì— ìƒì„±ëœ ì§ˆë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤\";\r\n            answerField.placeholder = \"ì§ˆë¬¸ì„ ìƒì„±í•  ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”\";\r\n            queryField.readOnly = true;\r\n            queryField.classList.add(\"output-only\");\r\n            answerField.classList.add(\"required-input\");\r\n            queryTypeSection.style.display = \"none\";\r\n            executeBtn.textContent = \"â“ ì§ˆë¬¸ ìƒì„±\";\r\n        } else if (mode === \"answer-only\") {\r\n            queryBadge.textContent = \"í•„ìˆ˜ ì…ë ¥\";\r\n            queryBadge.className = \"field-badge required\";\r\n            answerBadge.textContent = \"ìë™ ìƒì„±\";\r\n            answerBadge.className = \"field-badge output\";\r\n            queryHelp.innerHTML = \"âœ… <strong>ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</strong> (ì´ ë‚´ìš©ìœ¼ë¡œ ë‹µë³€ ìƒì„±)\";\r\n            answerHelp.innerHTML = \"ğŸ¤– <strong>ì§ˆë¬¸ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</strong>\";\r\n            queryField.placeholder = \"ë‹µë³€ì„ ìƒì„±í•  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”\";\r\n            answerField.placeholder = \"ì—¬ê¸°ì— ìƒì„±ëœ ë‹µë³€ì´ í‘œì‹œë©ë‹ˆë‹¤\";\r\n            answerField.readOnly = true;\r\n            answerField.classList.add(\"output-only\");\r\n            queryField.classList.add(\"required-input\");\r\n            queryTypeSection.style.display = \"block\";\r\n            executeBtn.textContent = \"ğŸ’¡ ë‹µë³€ ìƒì„±\";\r\n        }\r\n\r\n        this.updateValidation();\r\n    },\r\n    updateValidation() {\r\n        const queryVal = (document.getElementById(\"query\") as HTMLTextAreaElement).value.trim();\r\n        const answerVal = (document.getElementById(\"answer\") as HTMLTextAreaElement).value.trim();\r\n        const ocrVal = (document.getElementById(\"ocr-input\") as HTMLTextAreaElement).value.trim();\r\n        const globalRefVal = (document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement).value.trim();\r\n        const executeBtn = document.getElementById(\"execute-btn\") as HTMLButtonElement;\r\n\r\n        let isValid = false;\r\n        if (this.current === \"query-only\") {\r\n            isValid = Boolean(answerVal || ocrVal);\r\n        } else if (this.current === \"answer-only\") {\r\n            isValid = Boolean(queryVal);\r\n        } else {\r\n            isValid = Boolean(ocrVal || globalRefVal || queryVal || answerVal);\r\n        }\r\n\r\n        executeBtn.disabled = !isValid;\r\n        executeBtn.style.opacity = isValid ? \"1\" : \"0.6\";\r\n    },\r\n};\r\n\r\nfunction setButtonLoading(button: HTMLButtonElement | null, isLoading: boolean): void {\r\n    if (!button) return;\r\n    button.disabled = isLoading;\r\n    button.setAttribute(\"aria-busy\", String(isLoading));\r\n    if (isLoading) {\r\n        button.dataset.originalText =\r\n            button.dataset.originalText || button.textContent || \"\";\r\n        button.setAttribute(\"aria-label\", \"ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.\");\r\n        button.textContent = \"â³ ì²˜ë¦¬ ì¤‘...\";\r\n        button.style.opacity = \"0.6\";\r\n    } else {\r\n        button.textContent = button.dataset.originalText || button.textContent;\r\n        button.setAttribute(\"aria-label\", \"ì‹¤í–‰\");\r\n        button.style.opacity = \"1\";\r\n        button.removeAttribute(\"aria-busy\");\r\n    }\r\n}\r\n\r\nfunction handleResultHighlight(field: HTMLElement): void {\r\n    field.style.borderColor = \"var(--primary, #21808d)\";\r\n    field.style.boxShadow = \"0 0 0 3px rgba(33, 128, 141, 0.2)\";\r\n    setTimeout(() => {\r\n        field.style.borderColor = \"\";\r\n        field.style.boxShadow = \"\";\r\n    }, 2000);\r\n}\r\n\r\nfunction getWorkflowLabel(workflow: string): string {\r\n    const labels: Record<string, string> = {\r\n        full_generation: \"ğŸ¯ ì „ì²´ ìƒì„±\",\r\n        query_generation: \"â“ ì§ˆì˜ ìƒì„±\",\r\n        answer_generation: \"ğŸ’¡ ë‹µë³€ ìƒì„±\",\r\n        edit_query: \"âœï¸ ì§ˆì˜ ìˆ˜ì •\",\r\n        edit_answer: \"âœï¸ ë‹µë³€ ìˆ˜ì •\",\r\n        edit_both: \"âœï¸ ì§ˆì˜+ë‹µë³€ ìˆ˜ì •\",\r\n        rewrite: \"âœ… ì¬ì‘ì„±/ê²€ìˆ˜\",\r\n    };\r\n    return labels[workflow] || workflow;\r\n}\r\n\r\nfunction displayResult(data: WorkspaceResult): void {\r\n    const currentMode = WorkspaceMode.current;\r\n    const canUpdateQuery = [\r\n        \"full_generation\",\r\n        \"query_generation\",\r\n        \"edit_query\",\r\n        \"edit_both\",\r\n    ].includes(data.workflow);\r\n\r\n    if (data.query && currentMode !== \"answer-only\" && canUpdateQuery) {\r\n        const queryField = document.getElementById(\"query\") as HTMLTextAreaElement;\r\n        queryField.value = data.query;\r\n        handleResultHighlight(queryField);\r\n    }\r\n\r\n    if (data.answer) {\r\n        const answerField = document.getElementById(\"answer\") as HTMLTextAreaElement;\r\n        answerField.value = data.answer;\r\n        handleResultHighlight(answerField);\r\n    }\r\n\r\n    const resultsDiv = document.getElementById(\"workspace-results\");\r\n    if (!resultsDiv) return;\r\n    resultsDiv.innerHTML = `\r\n        <div style=\"text-align: center; padding: 20px; background: #e8f5e9; border-radius: 8px; border: 1px solid #4caf50; margin-top: 20px; animation: fadeIn 0.3s;\">\r\n            <h3 style=\"margin: 0 0 10px 0; color: #4caf50;\">âœ… ${getWorkflowLabel(data.workflow)} ì™„ë£Œ</h3>\r\n            <p style=\"margin: 0; color: #666; font-size: 0.9em;\">\r\n                ${data.query ? \"ì§ˆì˜\" : \"\"}${data.query && data.answer ? \"ì™€ \" : \"\"}${data.answer ? \"ë‹µë³€\" : \"\"}ì´ ì…ë ¥ í•„ë“œì— ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.\r\n            </p>\r\n        </div>\r\n    `;\r\n\r\n    setTimeout(() => {\r\n        resultsDiv.innerHTML = \"\";\r\n    }, 3000);\r\n}\r\n\r\nfunction copyFieldContent(fieldId: string, buttonEl: HTMLElement): void {\r\n    const field = document.getElementById(fieldId) as HTMLTextAreaElement;\r\n    const text = field.value.trim();\r\n    if (!text) {\r\n        showToast(\"ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.\", \"error\");\r\n        return;\r\n    }\r\n    copyToClipboard(text, buttonEl);\r\n}\r\n\r\nfunction restoreSession(): void {\r\n    const savedQuery = sessionStorage.getItem(\"workspace_query\");\r\n    const savedAnswer = sessionStorage.getItem(\"workspace_answer\");\r\n    if (savedQuery) {\r\n        (document.getElementById(\"query\") as HTMLTextAreaElement).value = savedQuery;\r\n        sessionStorage.removeItem(\"workspace_query\");\r\n    }\r\n    if (savedAnswer) {\r\n        (document.getElementById(\"answer\") as HTMLTextAreaElement).value = savedAnswer;\r\n        sessionStorage.removeItem(\"workspace_answer\");\r\n    }\r\n}\r\n\r\nfunction restoreReference(): void {\r\n    const savedRef = localStorage.getItem(GLOBAL_EXPLANATION_KEY);\r\n    if (savedRef) {\r\n        (document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement).value = savedRef;\r\n    }\r\n}\r\n\r\nfunction setupReferenceAutoSave(): void {\r\n    let saveRefTimeout: number; // Browser setTimeout returns number\r\n    const refElement = document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement;\r\n    refElement.addEventListener(\"input\", (e) => {\r\n        clearTimeout(saveRefTimeout);\r\n        const value = (e.target as HTMLTextAreaElement).value;\r\n        saveRefTimeout = setTimeout(() => {\r\n            localStorage.setItem(GLOBAL_EXPLANATION_KEY, value);\r\n        }, 300);\r\n    });\r\n\r\n    document.getElementById(\"clear-reference-btn\")?.addEventListener(\"click\", () => {\r\n        refElement.value = \"\";\r\n        localStorage.removeItem(GLOBAL_EXPLANATION_KEY);\r\n    });\r\n}\r\n\r\nfunction setupTabs(): void {\r\n    const tabs = document.querySelectorAll(\".workspace-mode-tabs .mode-tab\");\r\n    tabs.forEach((btn) => {\r\n        const htmlBtn = btn as HTMLElement;\r\n        htmlBtn.addEventListener(\"click\", () => {\r\n            tabs.forEach((b) => b.classList.remove(\"active\"));\r\n            htmlBtn.classList.add(\"active\");\r\n            if (htmlBtn.dataset.mode) {\r\n                WorkspaceMode.switchTo(htmlBtn.dataset.mode);\r\n            }\r\n        });\r\n\r\n        // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜\r\n        htmlBtn.addEventListener(\"keydown\", (e: KeyboardEvent) => {\r\n            const index = Array.from(tabs).indexOf(htmlBtn);\r\n            let newIndex = index;\r\n            if (e.key === \"ArrowRight\") newIndex = (index + 1) % tabs.length;\r\n            if (e.key === \"ArrowLeft\")\r\n                newIndex = (index - 1 + tabs.length) % tabs.length;\r\n            if (e.key === \"Home\") newIndex = 0;\r\n            if (e.key === \"End\") newIndex = tabs.length - 1;\r\n            if (newIndex !== index) {\r\n                e.preventDefault();\r\n                (tabs[newIndex] as HTMLElement).click();\r\n                (tabs[newIndex] as HTMLElement).focus();\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction setupValidationInputs(): void {\r\n    let validationTimeout: number;\r\n    const debouncedValidation = () => {\r\n        clearTimeout(validationTimeout);\r\n        validationTimeout = setTimeout(() => WorkspaceMode.updateValidation(), 150);\r\n    };\r\n\r\n    [\"query\", \"answer\", \"ocr-input\", \"global-explanation-ref\"].forEach((id) => {\r\n        const el = document.getElementById(id);\r\n        if (el) {\r\n            el.addEventListener(\"input\", debouncedValidation);\r\n        }\r\n    });\r\n}\r\n\r\nasync function executeWorkspace(\r\n    mode: string,\r\n    query: string | null,\r\n    answer: string | null,\r\n    editRequest: string | null,\r\n    signal: AbortSignal\r\n): Promise<void> {\r\n    const resultsDiv = document.getElementById(\"workspace-results\");\r\n    if (!resultsDiv) return;\r\n    resultsDiv.innerHTML = `\r\n        <div style=\"text-align: center; padding: 20px; background: var(--bg-secondary, #f5f5f5); border-radius: 8px; margin-top: 20px;\">\r\n            <p style=\"color: var(--text-primary, #1f2121); margin: 0;\">â³ ì²˜ë¦¬ ì¤‘...</p>\r\n        </div>\r\n    `;\r\n\r\n    const body: WorkspacePayload = {\r\n        mode,\r\n        query: query || null,\r\n        answer: answer || null,\r\n        edit_request: editRequest || null,\r\n        ocr_text: (document.getElementById(\"ocr-input\") as HTMLTextAreaElement).value || null,\r\n        query_type: (document.getElementById(\"query-type\") as HTMLSelectElement).value || null,\r\n        global_explanation_ref:\r\n            (document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement).value.trim() || null,\r\n    };\r\n\r\n    if (mode === \"query-only\" && !editRequest) {\r\n        body.query = null;\r\n    } else if (mode === \"answer-only\" && !editRequest) {\r\n        body.answer = null;\r\n    }\r\n\r\n    const result = await apiCall<WorkspaceResult>(\"/api/workspace/unified\", \"POST\", body, signal);\n    displayResult(result);\r\n}\r\n\r\nexport function initWorkspace(): void {\r\n    loadOCR();\r\n    document.getElementById(\"save-ocr-btn\")?.addEventListener(\"click\", () => saveOCR());\r\n    restoreSession();\r\n    restoreReference();\r\n    setupReferenceAutoSave();\r\n    setupTabs();\r\n    setupValidationInputs();\r\n    WorkspaceMode.switchTo(\"full\");\r\n\r\n    // ë³µì‚¬ ë²„íŠ¼ë“¤\r\n    document.querySelectorAll(\"[data-copy-target]\").forEach((btn) => {\r\n        const htmlBtn = btn as HTMLElement;\r\n        htmlBtn.addEventListener(\"click\", () => {\r\n            if (htmlBtn.dataset.copyTarget) {\r\n                copyFieldContent(htmlBtn.dataset.copyTarget, htmlBtn);\r\n            }\r\n        });\r\n    });\r\n\r\n    let isExecuting = false;\r\n    let abortController: AbortController | null = null;\r\n\r\n    document.getElementById(\"execute-btn\")?.addEventListener(\"click\", async () => {\r\n        if (isExecuting) return;\r\n        if (abortController) abortController.abort();\r\n        abortController = new AbortController();\r\n        const executeBtn = document.getElementById(\"execute-btn\") as HTMLButtonElement;\r\n        isExecuting = true;\r\n        setButtonLoading(executeBtn, true);\r\n\r\n        const query = (document.getElementById(\"query\") as HTMLTextAreaElement).value.trim();\r\n        const answer = (document.getElementById(\"answer\") as HTMLTextAreaElement).value.trim();\r\n        const editRequest = (document.getElementById(\"edit-request\") as HTMLTextAreaElement).value.trim();\r\n\r\n        try {\r\n            await executeWorkspace(\r\n                WorkspaceMode.current,\r\n                query,\r\n                answer,\r\n                editRequest,\r\n                abortController.signal,\r\n            );\r\n        } catch (error: unknown) {\n            const resultsDiv = document.getElementById(\"workspace-results\");\n            if (resultsDiv) {\n                const message =\n                    error instanceof Error\n                        ? error.message\n                        : \"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\";\n                resultsDiv.innerHTML = `\n                    <div style=\"text-align: center; padding: 20px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;\">\n                        <p style=\"color: #f44336; margin: 0;\">âŒ ì‘ì—… ì‹¤íŒ¨: ${message}</p>\n                    </div>\n                `;\n            }\n        } finally {\n            isExecuting = false;\r\n            setButtonLoading(executeBtn, false);\r\n        }\r\n    });\r\n}\r\n","import { apiCall, showToast } from \"./utils.js\";\r\nimport { loadOCR, saveOCR } from \"./ocr.js\";\r\n\r\ninterface EvalCandidate {\r\n    candidate_id: string;\r\n    score: number;\r\n    feedback: string;\r\n}\r\n\r\ninterface EvalResponse {\r\n    best: string;\r\n    results: EvalCandidate[];\r\n}\r\n\r\nexport function initEval(): void {\r\n    loadOCR();\r\n    document.getElementById(\"save-ocr-btn\")?.addEventListener(\"click\", () => saveOCR());\r\n\r\n    document.getElementById(\"eval-btn\")?.addEventListener(\"click\", async () => {\r\n        const query = (document.getElementById(\"query\") as HTMLTextAreaElement).value;\r\n        const answers = [\r\n            (document.getElementById(\"answer-a\") as HTMLTextAreaElement).value,\r\n            (document.getElementById(\"answer-b\") as HTMLTextAreaElement).value,\r\n            (document.getElementById(\"answer-c\") as HTMLTextAreaElement).value,\r\n        ];\r\n\r\n        if (!query || answers.some((a) => !a.trim())) {\r\n            showToast(\"ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\", \"error\");\r\n            return;\r\n        }\r\n\r\n        await evaluateAnswers(query, answers);\r\n    });\r\n}\r\n\r\nasync function evaluateAnswers(query: string, answers: string[]): Promise<void> {\r\n    const resultsDiv = document.getElementById(\"eval-results\");\r\n    if (!resultsDiv) return;\r\n    resultsDiv.innerHTML = \"<div class=\\\"loading\\\"></div> ì²˜ë¦¬ ì¤‘...\";\r\n\r\n    try {\r\n        const data = await apiCall<EvalResponse>(\"/api/eval/external\", \"POST\", { query, answers });\r\n        resultsDiv.innerHTML = \"<h3>í‰ê°€ ê²°ê³¼</h3>\";\r\n\r\n        const table = document.createElement(\"table\");\r\n        table.innerHTML = `\r\n            <thead>\r\n                <tr>\r\n                    <th>ë‹µë³€</th>\r\n                    <th>ì ìˆ˜</th>\r\n                    <th>í”¼ë“œë°±</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                ${data.results\r\n                .map(\r\n                    (r) => `\r\n                    <tr class=\"${r.candidate_id === data.best ? \"best-answer\" : \"\"}\">\r\n                        <td>${r.candidate_id} ${r.candidate_id === data.best ? \"â­\" : \"\"}</td>\r\n                        <td>${r.score}</td>\r\n                        <td>${r.feedback}</td>\r\n                    </tr>\r\n                `,\r\n                )\r\n                .join(\"\")}\r\n            </tbody>\r\n        `;\r\n        resultsDiv.appendChild(table);\r\n    } catch (error: unknown) {\n        const message =\n            error instanceof Error ? error.message : \"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\";\n        resultsDiv.innerHTML = `<p style=\"color: var(--danger)\">í‰ê°€ ì‹¤íŒ¨: ${message}</p>`;\n    }\n}\n","import { initQA } from \"./qa.js\";\r\nimport { initWorkspace } from \"./workspace.js\";\r\nimport { initEval } from \"./eval.js\";\r\n\r\n// Entry point: í˜ì´ì§€ë³„ ì´ˆê¸°í™”\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n    const path = window.location.pathname;\r\n    if (path === \"/qa\") {\r\n        initQA();\r\n    } else if (path === \"/workspace\") {\r\n        initWorkspace();\r\n    } else if (path === \"/eval\") {\r\n        initEval();\r\n    }\r\n});\r\n"],"names":["copyTimeouts","sleep","ms","resolve","showToast","message","type","toast","ApiError","status","errorData","detail","handleApiError","error","apiCall","url","method","body","signal","options","response","copyToClipboard","text","buttonEl","timeout","err","showProgressWithEstimate","mode","estimatedTime","startTime","progressInterval","elapsed","progress","bar","withRetry","fn","retries","initialDelayMs","attempt","delay","lastError","retryable","loadOCR","targetId","input","value","saveOCR","sourceId","statusId","statusEl","activeController","getModeLabels","renderProgress","title","eta","escapeHtml","div","formatAnswer","formatted","getTypeBadge","copyToWorkspace","query","answer","isQAPair","candidate","extractPairs","raw","_a","_b","payload","candidates","displayResults","pairs","resultsDiv","allowed","p","item","index","card","copyBtn","generateQA","qtype","ocrText","stopProgress","progressBar","result","initQA","radio","e","selector","modeInput","qtypeInput","GLOBAL_EXPLANATION_KEY","WorkspaceMode","queryField","answerField","queryBadge","answerBadge","queryHelp","answerHelp","queryTypeSection","executeBtn","queryVal","answerVal","ocrVal","globalRefVal","isValid","setButtonLoading","button","isLoading","handleResultHighlight","field","getWorkflowLabel","workflow","displayResult","data","currentMode","canUpdateQuery","copyFieldContent","fieldId","restoreSession","savedQuery","savedAnswer","restoreReference","savedRef","setupReferenceAutoSave","saveRefTimeout","refElement","setupTabs","tabs","btn","htmlBtn","b","newIndex","setupValidationInputs","validationTimeout","debouncedValidation","id","el","executeWorkspace","editRequest","initWorkspace","isExecuting","abortController","initEval","answers","evaluateAnswers","table","r","path"],"mappings":"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"}