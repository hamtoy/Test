# 가이드 규범과 템플릿 정합성 검증

본 문서는 Notion 가이드([Text-Image QA] FAQ, Work Guide)의 규범이 `hamtoy/Test` 리포지토리의 템플릿 및 검사기 코드에 어떻게 반영되었는지 설명합니다.

## 1. 규범 대 템플릿 매핑 표

아래 표는 노션 규범과 템플릿·검사기 구현 항목을 교차 매핑한 것입니다.

| 노션 규범 요지 | 템플릿/검사기 구현 | 기대 효과 |
| :--- | :--- | :--- |
| **세션 3–4턴 제한** | 세션 빌더 파라미터 `session_turns=3/4` | 반려 기준 충족 및 유용성 중심 구성 |
| **설명문/요약문 1회 제한** | `used_expl_or_sum` 카운트 강제 | 중복 방지, 다양성 확보 |
| **4턴 시 설명+요약 동시 허용(제한적)** | `session_turns==4` and `variance_guard` | 특례 준수, 반려 예방 |
| **추론 질의 가능한 경우 필수** | `must_include_reasoning` 플래그 | 어뷰징 방지 및 기준 충족 |
| **계산 요청(단순 질의) 1회** | `used_calc` 카운트 | 규정 준수 자동화 |
| **표/그래프 참조 금지** | `has_table_chart`일 때 지시 강화, 금지 패턴 검출 | 오판정·반려 예방 |
| **문장 재구성 의무** | 리라이팅 템플릿과 자가 점검 | 어뷰징 오해 방지 |
| **마크다운 볼드/하이픈 규칙** | 출력 형식 절 포함 | 형식 일관성 강화 |
| **동일 위치 편중 금지** | `prior_focus_summary` 피드백 | 세션 유용성 향상 |

이 매핑은 규범이 코드와 프롬프트에 어떻게 실현되는지 명료하게 보여 주며, 검수 과정의 재현성과 투명성을 높입니다.

## 2. 금지 유형과 허용 유형 경계의 강화

**용어 질의**는 사용 불가로 지정되며, **설명문과 요약문의 부분형**은 금지되어 **전체형**으로만 허용됩니다. 

*   **템플릿**: 유형 선택 메뉴나 명시적 입력을 통해 허용 유형만 노출합니다.
*   **검사기**: 금지 유형의 흔적을 문장 패턴 단에서 탐지합니다.
    *   특히 “전체 이미지에 대해 요약/설명”과 같은 문구는 표/그래프 존재 시 금지되므로, `has_table_chart=True` 상황에서는 해당 문구가 생성되지 않도록 프롬프트가 선제적으로 문구를 대체하거나 경고를 발생시킵니다.

## 3. 평가·리라이팅 단계에서의 마크다운 준수 검증

*   **평가 템플릿**: 답변이 마크다운 규칙을 준수했는지의 항목을 포함합니다.
*   **리라이팅 템플릿**: **볼드 적용**과 **하이픈 규칙**에 대한 자가 점검(Self-check)을 결산부로 출력하게 설계되었습니다.

이는 형식적 일탈로 인한 반려를 줄이고, 작업자·검수자 사이의 기준 편차를 축소합니다. 규범 준수 수준은 최종 점수 산정에 반영되어, 가이드 위반이 자동적으로 점수 페널티를 가져오도록 항목 가중치를 조정할 수 있습니다.
