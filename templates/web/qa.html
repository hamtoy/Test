<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA ìƒì„± - Gemini QA System</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <h1>ğŸ¤– Gemini QA System</h1>
        <nav>
            <a href="/qa" class="active">QA ìƒì„±</a>
            <a href="/eval">ì™¸ë¶€ í‰ê°€</a>
            <a href="/workspace">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</a>
            <a href="/multimodal">ì´ë¯¸ì§€ ë¶„ì„</a>
        </nav>
    </header>

    <main>
        <section class="card">
            <h2>QA ìƒì„±</h2>
            <form id="qa-form">
                <div class="form-group">
                    <label for="mode">ìƒì„± ëª¨ë“œ</label>
                    <select id="mode" name="mode">
                        <option value="batch">4íƒ€ì… ì¼ê´„ ìƒì„±</option>
                        <option value="single">ë‹¨ì¼ íƒ€ì… ìƒì„±</option>
                    </select>
                </div>

                <div class="form-group" id="qtype-group" style="display:none;">
                    <label for="qtype">ì§ˆì˜ íƒ€ì…</label>
                    <select id="qtype" name="qtype">
                        <option value="global_explanation">ì „ì²´ ì„¤ëª…</option>
                        <option value="reasoning">ì¶”ë¡ </option>
                        <option value="target_short">ëŒ€ìƒ ë‹¨ë‹µí˜•</option>
                        <option value="target_long">ëŒ€ìƒ ì¥ë¬¸í˜•</option>
                    </select>
                </div>

                <button type="submit">ìƒì„±í•˜ê¸°</button>
            </form>
        </section>

        <section class="card" id="result-section" style="display:none;">
            <h2>ê²°ê³¼</h2>
            <div id="result"></div>
        </section>
    </main>

    <script>
        const modeSelect = document.getElementById('mode');
        const qtypeGroup = document.getElementById('qtype-group');

        modeSelect.addEventListener('change', function() {
            qtypeGroup.style.display = this.value === 'single' ? 'block' : 'none';
        });

        document.getElementById('qa-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const mode = document.getElementById('mode').value;
            const qtype = document.getElementById('qtype').value;

            const body = { mode };
            if (mode === 'single') {
                body.qtype = qtype;
            }

            try {
                const res = await fetch('/api/qa/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await res.json();

                const resultSection = document.getElementById('result-section');
                const resultDiv = document.getElementById('result');

                if (res.ok) {
                    let html = '';
                    if (data.mode === 'batch' && data.pairs) {
                        data.pairs.forEach(pair => {
                            html += `<div class="qa-pair">
                                <h3>[${pair.type}]</h3>
                                <p><strong>ì§ˆì˜:</strong> ${pair.query}</p>
                                <p><strong>ë‹µë³€:</strong> ${pair.answer}</p>
                            </div>`;
                        });
                    } else if (data.pair) {
                        html = `<div class="qa-pair">
                            <h3>[${data.pair.type}]</h3>
                            <p><strong>ì§ˆì˜:</strong> ${data.pair.query}</p>
                            <p><strong>ë‹µë³€:</strong> ${data.pair.answer}</p>
                        </div>`;
                    }
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<p class="error">${data.detail || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</p>`;
                }

                resultSection.style.display = 'block';
            } catch (err) {
                console.error(err);
                alert('ìš”ì²­ ì‹¤íŒ¨: ' + err.message);
            }
        });
    </script>
</body>
</html>
{% extends "layout.html" %}

{% block content %}
<div class="split-layout">
    <!-- ì™¼ìª½: OCR ì˜ì—­ -->
    <div class="left-panel">
        <h2>ğŸ“„ OCR í…ìŠ¤íŠ¸</h2>
        <div id="ocr-preview" class="ocr-box">ë¡œë”© ì¤‘...</div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ìƒì„± ì»¨íŠ¸ë¡¤ + ê²°ê³¼ -->
    <div class="right-panel">
        <div class="control-box">
            <h2>âš™ï¸ ìƒì„± ì˜µì…˜</h2>
            
            <label>
                <input type="radio" name="mode" value="batch" checked>
                4íƒ€ì… ì¼ê´„ ìƒì„±
            </label>
            
            <label>
                <input type="radio" name="mode" value="single">
                íƒ€ì…ë³„ ìƒì„±
            </label>

            <div id="type-selector" style="display:none; margin-top: 10px;">
                <select id="qtype">
                    <option value="global_explanation">ì „ë°˜ ì„¤ëª…</option>
                    <option value="reasoning">ì¶”ë¡ </option>
                    <option value="target_short">íƒ€ê²Ÿ ì§§ì€ ë‹µë³€</option>
                    <option value="target_long">íƒ€ê²Ÿ ê¸´ ë‹µë³€</option>
                </select>
            </div>

            <button id="generate-btn" class="btn-primary">ğŸš€ ìƒì„± ì‹¤í–‰</button>
        </div>

        <div id="results" class="results-area"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // OCR ë¡œë“œ
    loadOCR();

    // ëª¨ë“œ ì„ íƒ ì‹œ íƒ€ì… ì…€ë ‰í„° í† ê¸€
    document.querySelectorAll('input[name="mode"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
            const selector = document.getElementById('type-selector');
            selector.style.display = e.target.value === 'single' ? 'block' : 'none';
        });
    });

    // ìƒì„± ë²„íŠ¼
    document.getElementById('generate-btn').addEventListener('click', async () => {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const qtype = mode === 'single' ? document.getElementById('qtype').value : null;
        
        await generateQA(mode, qtype);
    });
</script>
{% endblock %}
