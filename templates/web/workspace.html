<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›Œí¬ìŠ¤í˜ì´ìŠ¤ - Gemini QA System</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <h1>ğŸ¤– Gemini QA System</h1>
        <nav>
            <a href="/qa">QA ìƒì„±</a>
            <a href="/eval">ì™¸ë¶€ í‰ê°€</a>
            <a href="/workspace" class="active">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</a>
            <a href="/multimodal">ì´ë¯¸ì§€ ë¶„ì„</a>
        </nav>
    </header>

    <main>
        <section class="card">
            <h2>ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h2>
            <p>ë‹µë³€ì„ ê²€ìˆ˜í•˜ê±°ë‚˜ ììœ ë¡­ê²Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <form id="workspace-form">
                <div class="form-group">
                    <label for="mode">ëª¨ë“œ</label>
                    <select id="mode" name="mode">
                        <option value="inspect">ê²€ìˆ˜ (ìë™ êµì •)</option>
                        <option value="edit">ììœ  ìˆ˜ì •</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="query">ì§ˆì˜ (ì„ íƒ)</label>
                    <textarea id="query" name="query" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label for="answer">ë‹µë³€</label>
                    <textarea id="answer" name="answer" rows="5" required></textarea>
                </div>

                <div class="form-group" id="edit-request-group" style="display:none;">
                    <label for="edit-request">ìˆ˜ì • ìš”ì²­</label>
                    <textarea id="edit-request" name="edit_request" rows="2"></textarea>
                </div>

                <button type="submit">ì‹¤í–‰</button>
            </form>
        </section>

        <section class="card" id="result-section" style="display:none;">
            <h2>ê²°ê³¼</h2>
            <div id="result"></div>
        </section>
    </main>

    <script>
        const modeSelect = document.getElementById('mode');
        const editRequestGroup = document.getElementById('edit-request-group');

        modeSelect.addEventListener('change', function() {
            editRequestGroup.style.display = this.value === 'edit' ? 'block' : 'none';
        });

        document.getElementById('workspace-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const mode = document.getElementById('mode').value;
            const query = document.getElementById('query').value;
            const answer = document.getElementById('answer').value;
            const editRequest = document.getElementById('edit-request').value;

            const body = { mode, query, answer };
            if (mode === 'edit') {
                body.edit_request = editRequest;
            }

            try {
                const res = await fetch('/api/workspace', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await res.json();

                const resultSection = document.getElementById('result-section');
                const resultDiv = document.getElementById('result');

                if (res.ok) {
                    let html = `<h3>${data.mode === 'inspect' ? 'ê²€ìˆ˜' : 'ìˆ˜ì •'} ê²°ê³¼</h3>`;
                    html += `<div class="diff">
                        <div class="original">
                            <h4>ì›ë³¸</h4>
                            <pre>${data.result.original}</pre>
                        </div>
                        <div class="modified">
                            <h4>${data.mode === 'inspect' ? 'êµì •ë¨' : 'ìˆ˜ì •ë¨'}</h4>
                            <pre>${data.result.fixed || data.result.edited}</pre>
                        </div>
                    </div>`;
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<p class="error">${data.detail || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</p>`;
                }

                resultSection.style.display = 'block';
            } catch (err) {
                console.error(err);
                alert('ìš”ì²­ ì‹¤íŒ¨: ' + err.message);
            }
        });
    </script>
</body>
</html>
{% extends "layout.html" %}

{% block content %}
<div class="split-layout">
    <!-- ì™¼ìª½: OCR ì˜ì—­ -->
    <div class="left-panel">
        <h2>ğŸ“„ OCR í…ìŠ¤íŠ¸</h2>
        <div id="ocr-preview" class="ocr-box">ë¡œë”© ì¤‘...</div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ -->
    <div class="right-panel">
        <h2>âœï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h2>
        
        <div class="form-group">
            <label>ì§ˆì˜ (ì„ íƒ)</label>
            <input type="text" id="query" placeholder="ì§ˆì˜ ë‚´ìš©">
        </div>

        <div class="form-group">
            <label>ë‹µë³€/í…ìŠ¤íŠ¸</label>
            <textarea id="answer" rows="8"></textarea>
        </div>

        <div class="form-group">
            <label>ëª¨ë“œ ì„ íƒ</label>
            <label>
                <input type="radio" name="mode" value="inspect" checked>
                ê²€ìˆ˜ ëª¨ë“œ (ìë™ êµì •)
            </label>
            <label>
                <input type="radio" name="mode" value="edit">
                ììœ  ìˆ˜ì • ëª¨ë“œ
            </label>
        </div>

        <div id="edit-request-box" style="display:none;" class="form-group">
            <label>ìˆ˜ì • ìš”ì²­</label>
            <input type="text" id="edit-request" placeholder="ì˜ˆ: ë” ê°„ê²°í•˜ê²Œ">
        </div>

        <button id="execute-btn" class="btn-primary">â–¶ï¸ ì‹¤í–‰</button>

        <div id="workspace-results" class="results-area"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    loadOCR();

    // ëª¨ë“œ ì„ íƒ ì‹œ ìˆ˜ì • ìš”ì²­ ë°•ìŠ¤ í† ê¸€
    document.querySelectorAll('input[name="mode"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
            const box = document.getElementById('edit-request-box');
            box.style.display = e.target.value === 'edit' ? 'block' : 'none';
        });
    });

    document.getElementById('execute-btn').addEventListener('click', async () => {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const query = document.getElementById('query').value;
        const answer = document.getElementById('answer').value;
        const editRequest = document.getElementById('edit-request').value;

        if (!answer.trim()) {
            alert('ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (mode === 'edit' && !editRequest.trim()) {
            alert('ìˆ˜ì • ìš”ì²­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        await executeWorkspace(mode, query, answer, editRequest);
    });
</script>
{% endblock %}
