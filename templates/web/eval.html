{% extends "layout.html" %}

{% block content %}
<div class="split-layout">
    <!-- ì™¼ìª½: OCR ì˜ì—­ -->
    <div class="left-panel">
        <h2>ğŸ“„ OCR í…ìŠ¤íŠ¸</h2>
        <textarea id="ocr-input" class="ocr-box" rows="20" placeholder="OCR í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <button id="save-ocr-btn" class="btn-primary">ğŸ’¾ ì €ì¥</button>
        <span id="ocr-save-status" style="margin-left: 10px;"></span>
    </div>

    <!-- ì˜¤ë¥¸ìª½: í‰ê°€ ì…ë ¥ -->
    <div class="right-panel">
        <h2>ğŸ“Š ì™¸ë¶€ ë‹µë³€ í‰ê°€</h2>
        
        <div class="form-group">
            <label>ì§ˆì˜</label>
            <input type="text" id="query" placeholder="ì§ˆì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-group">
            <label>ë‹µë³€ A</label>
            <textarea id="answer-a" rows="4"></textarea>
        </div>

        <div class="form-group">
            <label>ë‹µë³€ B</label>
            <textarea id="answer-b" rows="4"></textarea>
        </div>

        <div class="form-group">
            <label>ë‹µë³€ C</label>
            <textarea id="answer-c" rows="4"></textarea>
        </div>

        <button id="eval-btn" class="btn-primary">âš–ï¸ í‰ê°€ ì‹¤í–‰</button>

        <div id="eval-results" class="results-area"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // OCR í…ìŠ¤íŠ¸ ë¡œë“œ
    async function loadOCR() {
        try {
            const data = await apiCall('/api/ocr');
            const input = document.getElementById('ocr-input');
            
            if (data.ocr) {
                input.value = data.ocr;
            } else {
                input.value = '';
                input.placeholder = 'OCR íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”...';
            }
        } catch (error) {
            document.getElementById('ocr-input').value = '';
            document.getElementById('ocr-input').placeholder = 'OCR ë¡œë“œ ì‹¤íŒ¨';
        }
    }

    // OCR í…ìŠ¤íŠ¸ ì €ì¥
    async function saveOCR() {
        const text = document.getElementById('ocr-input').value;
        const statusEl = document.getElementById('ocr-save-status');
        
        try {
            const data = await apiCall('/api/ocr', 'POST', { text: text });
            statusEl.textContent = 'âœ… ì €ì¥ë¨';
            statusEl.style.color = 'var(--success, green)';
            setTimeout(() => statusEl.textContent = '', 2000);
        } catch (error) {
            statusEl.textContent = 'âŒ ì €ì¥ ì‹¤íŒ¨';
            statusEl.style.color = 'var(--danger, red)';
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ OCR í…ìŠ¤íŠ¸ ë¡œë“œ
    loadOCR();

    // ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('save-ocr-btn').addEventListener('click', saveOCR);

    document.getElementById('eval-btn').addEventListener('click', async () => {
        const query = document.getElementById('query').value;
        const answers = [
            document.getElementById('answer-a').value,
            document.getElementById('answer-b').value,
            document.getElementById('answer-c').value,
        ];

        if (!query || answers.some(a => !a.trim())) {
            alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        await evaluateAnswers(query, answers);
    });
</script>
{% endblock %}
