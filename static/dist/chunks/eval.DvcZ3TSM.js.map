{"version":3,"file":"eval.DvcZ3TSM.js","sources":["../../eval.ts"],"sourcesContent":["import { apiCall, showToast } from \"./utils.js\";\r\nimport { loadOCR, saveOCR } from \"./ocr.js\";\r\n\r\ninterface EvalCandidate {\r\n    candidate_id: string;\r\n    score: number;\r\n    feedback: string;\r\n}\r\n\r\ninterface EvalResponse {\r\n    best: string;\r\n    results: EvalCandidate[];\r\n}\r\n\r\nexport function initEval(): void {\r\n    loadOCR();\r\n    document.getElementById(\"save-ocr-btn\")?.addEventListener(\"click\", () => saveOCR());\r\n\r\n    document.getElementById(\"eval-btn\")?.addEventListener(\"click\", async () => {\r\n        const query = (document.getElementById(\"query\") as HTMLTextAreaElement).value;\r\n        const answers = [\r\n            (document.getElementById(\"answer-a\") as HTMLTextAreaElement).value,\r\n            (document.getElementById(\"answer-b\") as HTMLTextAreaElement).value,\r\n            (document.getElementById(\"answer-c\") as HTMLTextAreaElement).value,\r\n        ];\r\n\r\n        if (!query || answers.some((a) => !a.trim())) {\r\n            showToast(\"모든 필드를 입력해주세요.\", \"error\");\r\n            return;\r\n        }\r\n\r\n        await evaluateAnswers(query, answers);\r\n    });\r\n}\r\n\r\nasync function evaluateAnswers(query: string, answers: string[]): Promise<void> {\r\n    const resultsDiv = document.getElementById(\"eval-results\");\r\n    if (!resultsDiv) return;\r\n\r\n    // Create loading indicator using DOM API\r\n    resultsDiv.innerHTML = \"\";\r\n    const loadingDiv = document.createElement(\"div\");\r\n    loadingDiv.className = \"loading\";\r\n    resultsDiv.appendChild(loadingDiv);\r\n    resultsDiv.appendChild(document.createTextNode(\" 처리 중...\"));\r\n\r\n    try {\r\n        const data = await apiCall<EvalResponse>(\"/api/eval/external\", \"POST\", { query, answers });\r\n        resultsDiv.innerHTML = \"\";\r\n\r\n        const heading = document.createElement(\"h3\");\r\n        heading.textContent = \"평가 결과\";\r\n        resultsDiv.appendChild(heading);\r\n\r\n        const table = document.createElement(\"table\");\r\n        const thead = document.createElement(\"thead\");\r\n        const headerRow = document.createElement(\"tr\");\r\n        [\"답변\", \"점수\", \"피드백\"].forEach((text) => {\r\n            const th = document.createElement(\"th\");\r\n            th.textContent = text;\r\n            headerRow.appendChild(th);\r\n        });\r\n        thead.appendChild(headerRow);\r\n        table.appendChild(thead);\r\n\r\n        const tbody = document.createElement(\"tbody\");\r\n        data.results.forEach((r) => {\r\n            const row = document.createElement(\"tr\");\r\n            if (r.candidate_id === data.best) {\r\n                row.className = \"best-answer\";\r\n            }\r\n\r\n            const tdId = document.createElement(\"td\");\r\n            tdId.textContent = r.candidate_id + (r.candidate_id === data.best ? \" ⭐\" : \"\");\r\n            row.appendChild(tdId);\r\n\r\n            const tdScore = document.createElement(\"td\");\r\n            tdScore.textContent = String(r.score);\r\n            row.appendChild(tdScore);\r\n\r\n            const tdFeedback = document.createElement(\"td\");\r\n            tdFeedback.textContent = r.feedback;\r\n            row.appendChild(tdFeedback);\r\n\r\n            tbody.appendChild(row);\r\n        });\r\n        table.appendChild(tbody);\r\n        resultsDiv.appendChild(table);\r\n    } catch (error: unknown) {\r\n        resultsDiv.innerHTML = \"\";\r\n        const errorP = document.createElement(\"p\");\r\n        errorP.className = \"eval-error-message\";\r\n        errorP.textContent = `평가 실패: ${error instanceof Error ? error.message : \"알 수 없는 오류가 발생했습니다.\"}`;\r\n        resultsDiv.appendChild(errorP);\r\n    }\r\n}\r\n"],"names":["initEval","loadOCR","saveOCR","query","answers","a","showToast","evaluateAnswers","resultsDiv","loadingDiv","data","apiCall","heading","table","thead","headerRow","text","th","tbody","r","row","tdId","tdScore","tdFeedback","error","errorP"],"mappings":"4FAcO,SAASA,GAAiB,CAC7BC,EAAA,EACA,SAAS,eAAe,cAAc,GAAG,iBAAiB,QAAS,IAAMC,GAAS,EAElF,SAAS,eAAe,UAAU,GAAG,iBAAiB,QAAS,SAAY,CACvE,MAAMC,EAAS,SAAS,eAAe,OAAO,EAA0B,MAClEC,EAAU,CACX,SAAS,eAAe,UAAU,EAA0B,MAC5D,SAAS,eAAe,UAAU,EAA0B,MAC5D,SAAS,eAAe,UAAU,EAA0B,KAAA,EAGjE,GAAI,CAACD,GAASC,EAAQ,KAAMC,GAAM,CAACA,EAAE,KAAA,CAAM,EAAG,CAC1CC,EAAU,iBAAkB,OAAO,EACnC,MACJ,CAEA,MAAMC,EAAgBJ,EAAOC,CAAO,CACxC,CAAC,CACL,CAEA,eAAeG,EAAgBJ,EAAeC,EAAkC,CAC5E,MAAMI,EAAa,SAAS,eAAe,cAAc,EACzD,GAAI,CAACA,EAAY,OAGjBA,EAAW,UAAY,GACvB,MAAMC,EAAa,SAAS,cAAc,KAAK,EAC/CA,EAAW,UAAY,UACvBD,EAAW,YAAYC,CAAU,EACjCD,EAAW,YAAY,SAAS,eAAe,UAAU,CAAC,EAE1D,GAAI,CACA,MAAME,EAAO,MAAMC,EAAsB,qBAAsB,OAAQ,CAAE,MAAAR,EAAO,QAAAC,EAAS,EACzFI,EAAW,UAAY,GAEvB,MAAMI,EAAU,SAAS,cAAc,IAAI,EAC3CA,EAAQ,YAAc,QACtBJ,EAAW,YAAYI,CAAO,EAE9B,MAAMC,EAAQ,SAAS,cAAc,OAAO,EACtCC,EAAQ,SAAS,cAAc,OAAO,EACtCC,EAAY,SAAS,cAAc,IAAI,EAC7C,CAAC,KAAM,KAAM,KAAK,EAAE,QAASC,GAAS,CAClC,MAAMC,EAAK,SAAS,cAAc,IAAI,EACtCA,EAAG,YAAcD,EACjBD,EAAU,YAAYE,CAAE,CAC5B,CAAC,EACDH,EAAM,YAAYC,CAAS,EAC3BF,EAAM,YAAYC,CAAK,EAEvB,MAAMI,EAAQ,SAAS,cAAc,OAAO,EAC5CR,EAAK,QAAQ,QAASS,GAAM,CACxB,MAAMC,EAAM,SAAS,cAAc,IAAI,EACnCD,EAAE,eAAiBT,EAAK,OACxBU,EAAI,UAAY,eAGpB,MAAMC,EAAO,SAAS,cAAc,IAAI,EACxCA,EAAK,YAAcF,EAAE,cAAgBA,EAAE,eAAiBT,EAAK,KAAO,KAAO,IAC3EU,EAAI,YAAYC,CAAI,EAEpB,MAAMC,EAAU,SAAS,cAAc,IAAI,EAC3CA,EAAQ,YAAc,OAAOH,EAAE,KAAK,EACpCC,EAAI,YAAYE,CAAO,EAEvB,MAAMC,EAAa,SAAS,cAAc,IAAI,EAC9CA,EAAW,YAAcJ,EAAE,SAC3BC,EAAI,YAAYG,CAAU,EAE1BL,EAAM,YAAYE,CAAG,CACzB,CAAC,EACDP,EAAM,YAAYK,CAAK,EACvBV,EAAW,YAAYK,CAAK,CAChC,OAASW,EAAgB,CACrBhB,EAAW,UAAY,GACvB,MAAMiB,EAAS,SAAS,cAAc,GAAG,EACzCA,EAAO,UAAY,qBACnBA,EAAO,YAAc,UAAUD,aAAiB,MAAQA,EAAM,QAAU,oBAAoB,GAC5FhB,EAAW,YAAYiB,CAAM,CACjC,CACJ"}