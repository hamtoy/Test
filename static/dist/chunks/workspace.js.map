{"version":3,"file":"workspace.js","sources":["../../workspace.ts"],"sourcesContent":["import { apiCallWithRetry, copyToClipboard, showToast } from \"./utils.js\";\r\nimport { loadOCR, saveOCR } from \"./ocr.js\";\r\nimport { validateRequest, ValidationError } from \"./validation.js\";\r\n\r\nconst GLOBAL_EXPLANATION_KEY = \"workspace_global_explanation\";\r\n\r\ninterface WorkspaceMode {\r\n    current: \"full\" | \"query-only\" | \"answer-only\";\r\n    switchTo(mode: string): void;\r\n    updateValidation(): void;\r\n}\r\n\r\ninterface WorkspaceResult {\r\n    workflow: string;\r\n    query?: string;\r\n    answer?: string;\r\n}\r\n\r\ninterface WorkspacePayload {\r\n    mode: string;\r\n    query: string | null;\r\n    answer: string | null;\r\n    edit_request: string | null;\r\n    ocr_text: string | null;\r\n    query_type: string | null;\r\n    global_explanation_ref: string | null;\r\n}\r\n\r\nconst WorkspaceMode: WorkspaceMode = {\r\n    current: \"full\",\r\n    switchTo(mode: string) {\r\n        this.current = mode as \"full\" | \"query-only\" | \"answer-only\";\r\n        const queryField = document.getElementById(\"query\") as HTMLTextAreaElement;\r\n        const answerField = document.getElementById(\"answer\") as HTMLTextAreaElement;\r\n        const queryBadge = document.getElementById(\"query-badge\") as HTMLElement;\r\n        const answerBadge = document.getElementById(\"answer-badge\") as HTMLElement;\r\n        const queryHelp = document.getElementById(\"query-help\") as HTMLElement;\r\n        const answerHelp = document.getElementById(\"answer-help\") as HTMLElement;\r\n        const queryTypeSection = document.getElementById(\"query-type-section\") as HTMLElement;\r\n        const executeBtn = document.getElementById(\"execute-btn\") as HTMLButtonElement;\r\n\r\n        queryField.readOnly = false;\r\n        answerField.readOnly = false;\r\n        queryField.classList.remove(\"output-only\", \"required-input\");\r\n        answerField.classList.remove(\"output-only\", \"required-input\");\r\n\r\n        if (mode === \"full\") {\r\n            queryBadge.textContent = \"ÏÑ†ÌÉù\";\r\n            queryBadge.className = \"field-badge optional\";\r\n            answerBadge.textContent = \"ÏÑ†ÌÉù\";\r\n            answerBadge.className = \"field-badge optional\";\r\n            queryHelp.textContent = \"üí° ÎπÑÏõåÎëêÎ©¥ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§\";\r\n            answerHelp.textContent = \"üí° ÎπÑÏõåÎëêÎ©¥ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§\";\r\n            queryField.placeholder = \"ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÎπÑÏö∞Î©¥ ÏûêÎèô ÏÉùÏÑ±)\";\r\n            answerField.placeholder = \"ÎãµÎ≥ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÎπÑÏö∞Î©¥ ÏûêÎèô ÏÉùÏÑ±)\";\r\n            queryTypeSection.style.display = \"block\";\r\n            executeBtn.textContent = \"üöÄ Ïã§Ìñâ\";\r\n        } else if (mode === \"query-only\") {\r\n            queryBadge.textContent = \"ÏûêÎèô ÏÉùÏÑ±\";\r\n            queryBadge.className = \"field-badge output\";\r\n            answerBadge.textContent = \"ÌïÑÏàò ÏûÖÎ†•\";\r\n            answerBadge.className = \"field-badge required\";\r\n            queryHelp.innerHTML = \"ü§ñ <strong>ÎãµÎ≥Ä Í∏∞Î∞òÏúºÎ°ú ÏûêÎèô ÏÉùÏÑ±Îê©ÎãàÎã§</strong>\";\r\n            answerHelp.innerHTML = \"‚úÖ <strong>ÎãµÎ≥ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</strong> (Ïù¥ ÎÇ¥Ïö©ÏúºÎ°ú ÏßàÎ¨∏ ÏÉùÏÑ±)\";\r\n            queryField.placeholder = \"Ïó¨Í∏∞Ïóê ÏÉùÏÑ±Îêú ÏßàÎ¨∏Ïù¥ ÌëúÏãúÎê©ÎãàÎã§\";\r\n            answerField.placeholder = \"ÏßàÎ¨∏ÏùÑ ÏÉùÏÑ±Ìï† ÎãµÎ≥ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî\";\r\n            queryField.readOnly = true;\r\n            queryField.classList.add(\"output-only\");\r\n            answerField.classList.add(\"required-input\");\r\n            queryTypeSection.style.display = \"none\";\r\n            executeBtn.textContent = \"‚ùì ÏßàÎ¨∏ ÏÉùÏÑ±\";\r\n        } else if (mode === \"answer-only\") {\r\n            queryBadge.textContent = \"ÌïÑÏàò ÏûÖÎ†•\";\r\n            queryBadge.className = \"field-badge required\";\r\n            answerBadge.textContent = \"ÏûêÎèô ÏÉùÏÑ±\";\r\n            answerBadge.className = \"field-badge output\";\r\n            queryHelp.innerHTML = \"‚úÖ <strong>ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</strong> (Ïù¥ ÎÇ¥Ïö©ÏúºÎ°ú ÎãµÎ≥Ä ÏÉùÏÑ±)\";\r\n            answerHelp.innerHTML = \"ü§ñ <strong>ÏßàÎ¨∏ Í∏∞Î∞òÏúºÎ°ú ÏûêÎèô ÏÉùÏÑ±Îê©ÎãàÎã§</strong>\";\r\n            queryField.placeholder = \"ÎãµÎ≥ÄÏùÑ ÏÉùÏÑ±Ìï† ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî\";\r\n            answerField.placeholder = \"Ïó¨Í∏∞Ïóê ÏÉùÏÑ±Îêú ÎãµÎ≥ÄÏù¥ ÌëúÏãúÎê©ÎãàÎã§\";\r\n            answerField.readOnly = true;\r\n            answerField.classList.add(\"output-only\");\r\n            queryField.classList.add(\"required-input\");\r\n            queryTypeSection.style.display = \"block\";\r\n            executeBtn.textContent = \"üí° ÎãµÎ≥Ä ÏÉùÏÑ±\";\r\n        }\r\n\r\n        this.updateValidation();\r\n    },\r\n    updateValidation() {\r\n        const queryVal = (document.getElementById(\"query\") as HTMLTextAreaElement).value.trim();\r\n        const answerVal = (document.getElementById(\"answer\") as HTMLTextAreaElement).value.trim();\r\n        const ocrVal = (document.getElementById(\"ocr-input\") as HTMLTextAreaElement).value.trim();\r\n        const globalRefVal = (document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement).value.trim();\r\n        const executeBtn = document.getElementById(\"execute-btn\") as HTMLButtonElement;\r\n\r\n        let isValid = false;\r\n        if (this.current === \"query-only\") {\r\n            isValid = Boolean(answerVal || ocrVal);\r\n        } else if (this.current === \"answer-only\") {\r\n            isValid = Boolean(queryVal);\r\n        } else {\r\n            isValid = Boolean(ocrVal || globalRefVal || queryVal || answerVal);\r\n        }\r\n\r\n        executeBtn.disabled = !isValid;\r\n        executeBtn.style.opacity = isValid ? \"1\" : \"0.6\";\r\n    },\r\n};\r\n\r\nfunction setButtonLoading(button: HTMLButtonElement | null, isLoading: boolean): void {\r\n    if (!button) return;\r\n    button.disabled = isLoading;\r\n    button.setAttribute(\"aria-busy\", String(isLoading));\r\n    if (isLoading) {\r\n        button.dataset.originalText =\r\n            button.dataset.originalText || button.textContent || \"\";\r\n        button.setAttribute(\"aria-label\", \"Ï≤òÎ¶¨ Ï§ëÏûÖÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.\");\r\n        button.textContent = \"‚è≥ Ï≤òÎ¶¨ Ï§ë...\";\r\n        button.style.opacity = \"0.6\";\r\n    } else {\r\n        button.textContent = button.dataset.originalText || button.textContent;\r\n        button.setAttribute(\"aria-label\", \"Ïã§Ìñâ\");\r\n        button.style.opacity = \"1\";\r\n        button.removeAttribute(\"aria-busy\");\r\n    }\r\n}\r\n\r\nfunction handleResultHighlight(field: HTMLElement): void {\r\n    field.style.borderColor = \"var(--primary, #21808d)\";\r\n    field.style.boxShadow = \"0 0 0 3px rgba(33, 128, 141, 0.2)\";\r\n    setTimeout(() => {\r\n        field.style.borderColor = \"\";\r\n        field.style.boxShadow = \"\";\r\n    }, 2000);\r\n}\r\n\r\nfunction getWorkflowLabel(workflow: string): string {\r\n    const labels: Record<string, string> = {\r\n        full_generation: \"üéØ Ï†ÑÏ≤¥ ÏÉùÏÑ±\",\r\n        query_generation: \"‚ùì ÏßàÏùò ÏÉùÏÑ±\",\r\n        answer_generation: \"üí° ÎãµÎ≥Ä ÏÉùÏÑ±\",\r\n        edit_query: \"‚úèÔ∏è ÏßàÏùò ÏàòÏ†ï\",\r\n        edit_answer: \"‚úèÔ∏è ÎãµÎ≥Ä ÏàòÏ†ï\",\r\n        edit_both: \"‚úèÔ∏è ÏßàÏùò+ÎãµÎ≥Ä ÏàòÏ†ï\",\r\n        rewrite: \"‚úÖ Ïû¨ÏûëÏÑ±/Í≤ÄÏàò\",\r\n    };\r\n    return labels[workflow] || workflow;\r\n}\r\n\r\nfunction displayResult(data: WorkspaceResult): void {\r\n    const currentMode = WorkspaceMode.current;\r\n    const canUpdateQuery = [\r\n        \"full_generation\",\r\n        \"query_generation\",\r\n        \"edit_query\",\r\n        \"edit_both\",\r\n    ].includes(data.workflow);\r\n\r\n    if (data.query && currentMode !== \"answer-only\" && canUpdateQuery) {\r\n        const queryField = document.getElementById(\"query\") as HTMLTextAreaElement;\r\n        queryField.value = data.query;\r\n        handleResultHighlight(queryField);\r\n    }\r\n\r\n    if (data.answer) {\r\n        const answerField = document.getElementById(\"answer\") as HTMLTextAreaElement;\r\n        answerField.value = data.answer;\r\n        handleResultHighlight(answerField);\r\n    }\r\n\r\n    const resultsDiv = document.getElementById(\"workspace-results\");\r\n    if (!resultsDiv) return;\r\n    resultsDiv.innerHTML = `\r\n        <div style=\"text-align: center; padding: 20px; background: #e8f5e9; border-radius: 8px; border: 1px solid #4caf50; margin-top: 20px; animation: fadeIn 0.3s;\">\r\n            <h3 style=\"margin: 0 0 10px 0; color: #4caf50;\">‚úÖ ${getWorkflowLabel(data.workflow)} ÏôÑÎ£å</h3>\r\n            <p style=\"margin: 0; color: #666; font-size: 0.9em;\">\r\n                ${data.query ? \"ÏßàÏùò\" : \"\"}${data.query && data.answer ? \"ÏôÄ \" : \"\"}${data.answer ? \"ÎãµÎ≥Ä\" : \"\"}Ïù¥ ÏûÖÎ†• ÌïÑÎìúÏóê ÏûêÎèôÏúºÎ°ú Ï±ÑÏõåÏ°åÏäµÎãàÎã§.\r\n            </p>\r\n        </div>\r\n    `;\r\n\r\n    setTimeout(() => {\r\n        resultsDiv.innerHTML = \"\";\r\n    }, 3000);\r\n}\r\n\r\nfunction copyFieldContent(fieldId: string, buttonEl: HTMLElement): void {\r\n    const field = document.getElementById(fieldId) as HTMLTextAreaElement;\r\n    const text = field.value.trim();\r\n    if (!text) {\r\n        showToast(\"Î≥µÏÇ¨Ìï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.\", \"error\");\r\n        return;\r\n    }\r\n    copyToClipboard(text, buttonEl);\r\n}\r\n\r\nfunction restoreSession(): void {\r\n    const savedQuery = sessionStorage.getItem(\"workspace_query\");\r\n    const savedAnswer = sessionStorage.getItem(\"workspace_answer\");\r\n    if (savedQuery) {\r\n        (document.getElementById(\"query\") as HTMLTextAreaElement).value = savedQuery;\r\n        sessionStorage.removeItem(\"workspace_query\");\r\n    }\r\n    if (savedAnswer) {\r\n        (document.getElementById(\"answer\") as HTMLTextAreaElement).value = savedAnswer;\r\n        sessionStorage.removeItem(\"workspace_answer\");\r\n    }\r\n}\r\n\r\nfunction restoreReference(): void {\r\n    const savedRef = localStorage.getItem(GLOBAL_EXPLANATION_KEY);\r\n    if (savedRef) {\r\n        (document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement).value = savedRef;\r\n    }\r\n}\r\n\r\nfunction setupReferenceAutoSave(): void {\r\n    let saveRefTimeout: number; // Browser setTimeout returns number\r\n    const refElement = document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement;\r\n    refElement.addEventListener(\"input\", (e) => {\r\n        clearTimeout(saveRefTimeout);\r\n        const value = (e.target as HTMLTextAreaElement).value;\r\n        saveRefTimeout = setTimeout(() => {\r\n            localStorage.setItem(GLOBAL_EXPLANATION_KEY, value);\r\n        }, 300);\r\n    });\r\n\r\n    document.getElementById(\"clear-reference-btn\")?.addEventListener(\"click\", () => {\r\n        refElement.value = \"\";\r\n        localStorage.removeItem(GLOBAL_EXPLANATION_KEY);\r\n    });\r\n}\r\n\r\nfunction setupTabs(): void {\r\n    const tabs = document.querySelectorAll(\".workspace-mode-tabs .mode-tab\");\r\n    tabs.forEach((btn) => {\r\n        const htmlBtn = btn as HTMLElement;\r\n        htmlBtn.addEventListener(\"click\", () => {\r\n            tabs.forEach((b) => b.classList.remove(\"active\"));\r\n            htmlBtn.classList.add(\"active\");\r\n            if (htmlBtn.dataset.mode) {\r\n                WorkspaceMode.switchTo(htmlBtn.dataset.mode);\r\n            }\r\n        });\r\n\r\n        // ÌÇ§Î≥¥Îìú ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò\r\n        htmlBtn.addEventListener(\"keydown\", (e: KeyboardEvent) => {\r\n            const index = Array.from(tabs).indexOf(htmlBtn);\r\n            let newIndex = index;\r\n            if (e.key === \"ArrowRight\") newIndex = (index + 1) % tabs.length;\r\n            if (e.key === \"ArrowLeft\")\r\n                newIndex = (index - 1 + tabs.length) % tabs.length;\r\n            if (e.key === \"Home\") newIndex = 0;\r\n            if (e.key === \"End\") newIndex = tabs.length - 1;\r\n            if (newIndex !== index) {\r\n                e.preventDefault();\r\n                (tabs[newIndex] as HTMLElement).click();\r\n                (tabs[newIndex] as HTMLElement).focus();\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction setupValidationInputs(): void {\r\n    let validationTimeout: number;\r\n    const debouncedValidation = () => {\r\n        clearTimeout(validationTimeout);\r\n        validationTimeout = setTimeout(() => WorkspaceMode.updateValidation(), 150);\r\n    };\r\n\r\n    [\"query\", \"answer\", \"ocr-input\", \"global-explanation-ref\"].forEach((id) => {\r\n        const el = document.getElementById(id);\r\n        if (el) {\r\n            el.addEventListener(\"input\", debouncedValidation);\r\n        }\r\n    });\r\n}\r\n\r\nasync function executeWorkspace(\r\n    mode: string,\r\n    query: string | null,\r\n    answer: string | null,\r\n    editRequest: string | null,\r\n    signal: AbortSignal\r\n): Promise<void> {\r\n    const resultsDiv = document.getElementById(\"workspace-results\");\r\n    if (!resultsDiv) return;\r\n    resultsDiv.innerHTML = `\r\n        <div style=\"text-align: center; padding: 20px; background: var(--bg-secondary, #f5f5f5); border-radius: 8px; margin-top: 20px;\">\r\n            <p style=\"color: var(--text-primary, #1f2121); margin: 0;\">‚è≥ Ï≤òÎ¶¨ Ï§ë...</p>\r\n        </div>\r\n    `;\r\n\r\n    const body: WorkspacePayload = {\r\n        mode,\r\n        query: query || null,\r\n        answer: answer || null,\r\n        edit_request: editRequest || null,\r\n        ocr_text: (document.getElementById(\"ocr-input\") as HTMLTextAreaElement).value || null,\r\n        query_type: (document.getElementById(\"query-type\") as HTMLSelectElement).value || null,\r\n        global_explanation_ref:\r\n            (document.getElementById(\"global-explanation-ref\") as HTMLTextAreaElement).value.trim() || null,\r\n    };\r\n\r\n    if (mode === \"query-only\" && !editRequest) {\r\n        body.query = null;\r\n    } else if (mode === \"answer-only\" && !editRequest) {\r\n        body.answer = null;\r\n    }\r\n\r\n    // Validate request payload before sending\r\n    try {\r\n        validateRequest(body, \"/api/workspace/unified\");\r\n    } catch (validationError) {\r\n        if (validationError instanceof ValidationError) {\r\n            resultsDiv.innerHTML = `\r\n                <div style=\"text-align: center; padding: 30px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;\">\r\n                    <h3 style=\"color: #f44336; margin-bottom: 10px;\">‚ö†Ô∏è ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ Ïò§Î•ò</h3>\r\n                    <p style=\"color: #666; margin: 0; white-space: pre-line;\">${validationError.message}</p>\r\n                    <p style=\"color: #999; margin-top: 15px; font-size: 0.9em;\">üí° ÌïÑÎìúÎ™ÖÍ≥º Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>\r\n                </div>\r\n            `;\r\n            throw validationError;\r\n        }\r\n        throw validationError;\r\n    }\r\n\r\n    const result = await apiCallWithRetry<WorkspaceResult>({\n        url: \"/api/workspace/unified\",\n        method: \"POST\",\n        body,\n        signal,\n        retries: 2,\n        initialDelayMs: 400,\n    });\n    displayResult(result);\r\n}\r\n\r\nexport function initWorkspace(): void {\r\n    loadOCR();\r\n    document.getElementById(\"save-ocr-btn\")?.addEventListener(\"click\", () => saveOCR());\r\n    restoreSession();\r\n    restoreReference();\r\n    setupReferenceAutoSave();\r\n    setupTabs();\r\n    setupValidationInputs();\r\n    WorkspaceMode.switchTo(\"full\");\r\n\r\n    // Î≥µÏÇ¨ Î≤ÑÌäºÎì§\r\n    document.querySelectorAll(\"[data-copy-target]\").forEach((btn) => {\r\n        const htmlBtn = btn as HTMLElement;\r\n        htmlBtn.addEventListener(\"click\", () => {\r\n            if (htmlBtn.dataset.copyTarget) {\r\n                copyFieldContent(htmlBtn.dataset.copyTarget, htmlBtn);\r\n            }\r\n        });\r\n    });\r\n\r\n    let isExecuting = false;\r\n    let abortController: AbortController | null = null;\r\n\r\n    document.getElementById(\"execute-btn\")?.addEventListener(\"click\", async () => {\r\n        if (isExecuting) return;\r\n        if (abortController) abortController.abort();\r\n        abortController = new AbortController();\r\n        const executeBtn = document.getElementById(\"execute-btn\") as HTMLButtonElement;\r\n        isExecuting = true;\r\n        setButtonLoading(executeBtn, true);\r\n\r\n        const query = (document.getElementById(\"query\") as HTMLTextAreaElement).value.trim();\r\n        const answer = (document.getElementById(\"answer\") as HTMLTextAreaElement).value.trim();\r\n        const editRequest = (document.getElementById(\"edit-request\") as HTMLTextAreaElement).value.trim();\r\n\r\n        try {\r\n            await executeWorkspace(\r\n                WorkspaceMode.current,\r\n                query,\r\n                answer,\r\n                editRequest,\r\n                abortController.signal,\r\n            );\r\n        } catch (error: unknown) {\n            const resultsDiv = document.getElementById(\"workspace-results\");\n            if (resultsDiv) {\n                const message =\n                    error instanceof Error\n                        ? error.message\n                        : \"Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\";\n                resultsDiv.innerHTML = `\n                    <div style=\"text-align: center; padding: 20px; background: #ffebee; border-radius: 8px; border: 1px solid #f44336; margin-top: 20px;\">\n                        <p style=\"color: #f44336; margin: 0;\">‚ùå ÏûëÏóÖ Ïã§Ìå®: ${message}</p>\n                    </div>\n                `;\n            }\n        } finally {\n            isExecuting = false;\r\n            setButtonLoading(executeBtn, false);\r\n        }\r\n    });\r\n}\r\n"],"names":["GLOBAL_EXPLANATION_KEY","WorkspaceMode","mode","queryField","answerField","queryBadge","answerBadge","queryHelp","answerHelp","queryTypeSection","executeBtn","queryVal","answerVal","ocrVal","globalRefVal","isValid","setButtonLoading","button","isLoading","handleResultHighlight","field","getWorkflowLabel","workflow","displayResult","data","currentMode","canUpdateQuery","resultsDiv","copyFieldContent","fieldId","buttonEl","text","showToast","copyToClipboard","restoreSession","savedQuery","savedAnswer","restoreReference","savedRef","setupReferenceAutoSave","saveRefTimeout","refElement","e","value","_a","setupTabs","tabs","btn","htmlBtn","b","index","newIndex","setupValidationInputs","validationTimeout","debouncedValidation","id","el","executeWorkspace","query","answer","editRequest","signal","body","validateRequest","validationError","ValidationError","result","apiCallWithRetry","initWorkspace","loadOCR","saveOCR","isExecuting","abortController","_b","error","message"],"mappings":"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"}