{"version":3,"mappings":"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","names":["copyTimeouts","sleep","ms","resolve","debounce","fn","delay","timeoutId","args","showToast","message","type","toast","ApiError","status","errorData","detail","handleApiError","error","__vitePreload","parse422Error","detailedMessage","registerGlobalErrorHandlers","event","reason","apiCall","url","method","body","signal","options","response","apiCallWithRetry","params","retries","initialDelayMs","rest","withRetry","copyToClipboard","text","buttonEl","timeout","err","showProgressWithEstimate","mode","estimatedTime","startTime","progressInterval","elapsed","progress","bar","attempt","lastError","retryable","path","initQA","initWorkspace","initEval"],"ignoreList":[],"sources":["../utils.ts","../app.ts"],"sourcesContent":["// 공통 유틸 함수 모음\r\n\r\nconst copyTimeouts = new Map<HTMLElement, number>();\r\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\n/**\r\n * Creates a debounced function that delays invoking fn until after delay ms\r\n * have elapsed since the last time the debounced function was invoked.\r\n */\r\nexport function debounce<T extends (...args: Parameters<T>) => void>(\r\n    fn: T,\r\n    delay: number\r\n): (...args: Parameters<T>) => void {\r\n    let timeoutId: ReturnType<typeof setTimeout> | undefined;\r\n    return (...args: Parameters<T>) => {\r\n        if (timeoutId !== undefined) {\r\n            clearTimeout(timeoutId);\r\n        }\r\n        timeoutId = setTimeout(() => {\r\n            fn(...args);\r\n            timeoutId = undefined;\r\n        }, delay);\r\n    };\r\n}\r\n\r\nexport type ToastType = \"info\" | \"success\" | \"warning\" | \"error\";\r\n\r\nexport function showToast(message: string, type: ToastType = \"info\"): void {\r\n    if (typeof document === \"undefined\") {\r\n        console.warn(`[toast:${type}] ${message}`);\r\n        return;\r\n    }\r\n    const toast = document.createElement(\"div\");\r\n    toast.className = `toast toast--${type}`;\r\n    toast.textContent = message;\r\n    document.body.appendChild(toast);\r\n\r\n    requestAnimationFrame(() => toast.classList.add(\"toast--show\"));\r\n    setTimeout(() => {\r\n        toast.classList.remove(\"toast--show\");\r\n        setTimeout(() => toast.remove(), 300);\r\n    }, 3000);\r\n}\r\n\r\nexport interface ApiErrorData {\r\n    detail?: string;\r\n    message?: string;\r\n    [key: string]: unknown;\r\n}\r\n\r\nexport class ApiError extends Error {\r\n    status: number;\r\n    canRetry: boolean;\r\n    errorData: ApiErrorData;\r\n\r\n    constructor(status: number, errorData: ApiErrorData = {}) {\r\n        const messages: Record<number, string> = {\r\n            400: \"잘못된 요청입니다\",\r\n            401: \"인증이 필요합니다\",\r\n            403: \"접근 권한이 없습니다\",\r\n            404: \"요청한 리소스를 찾을 수 없습니다\",\r\n            422: \"요청 데이터 검증 실패\",\r\n            429: \"요청이 너무 많습니다. 잠시 후 다시 시도해주세요\",\r\n            500: \"서버 오류가 발생했습니다\",\r\n            502: \"게이트웨이 오류입니다\",\r\n            503: \"서비스를 일시적으로 사용할 수 없습니다\",\r\n            504: \"LLM 응답 시간이 초과되었습니다. 잠시 후 다시 시도해주세요\",\r\n        };\r\n\r\n        const detail =\r\n            messages[status] ||\r\n            errorData.detail ||\r\n            errorData.message ||\r\n            \"요청 실패\";\r\n        super(detail);\r\n        this.status = status;\r\n        this.canRetry = [429, 500, 502, 503, 504].includes(status);\r\n        this.errorData = errorData;\r\n    }\r\n}\r\n\r\nfunction handleApiError(error: unknown): void {\r\n    console.error(\"API Error:\", error);\r\n    if (error instanceof ApiError) {\r\n        // Special handling for 422 validation errors\r\n        if (error.status === 422) {\r\n            // Import parse422Error dynamically to avoid circular dependency\r\n            import(\"./validation.js\").then(({ parse422Error }) => {\r\n                const detailedMessage = parse422Error(error.errorData);\r\n                showToast(detailedMessage, \"error\");\r\n            }).catch(() => {\r\n                showToast(error.message, \"error\");\r\n            });\r\n            return;\r\n        }\r\n        \r\n        if (error.canRetry) {\r\n            showToast(`${error.message} [다시 시도 가능]`, \"warning\");\r\n        } else {\r\n            showToast(error.message, \"error\");\r\n        }\r\n    } else if (error instanceof Error) {\r\n        showToast(error.message, \"error\");\r\n    } else {\r\n        showToast(\"알 수 없는 오류가 발생했습니다.\", \"error\");\r\n    }\r\n}\r\n\r\nexport function registerGlobalErrorHandlers(): void {\r\n    if (typeof window === \"undefined\") return;\r\n    window.addEventListener(\"error\", (event: ErrorEvent) => {\r\n        if (event.error) {\r\n            showToast(`오류: ${event.error.message}`, \"error\");\r\n        } else {\r\n            showToast(\"알 수 없는 오류가 발생했습니다.\", \"error\");\r\n        }\r\n    });\r\n    window.addEventListener(\"unhandledrejection\", (event: PromiseRejectionEvent) => {\r\n        const reason = event.reason;\r\n        if (reason instanceof Error) {\r\n            showToast(`오류: ${reason.message}`, \"error\");\r\n        } else if (typeof reason === \"string\") {\r\n            showToast(`오류: ${reason}`, \"error\");\r\n        } else {\r\n            showToast(\"알 수 없는 오류가 발생했습니다.\", \"error\");\r\n        }\r\n    });\r\n}\r\n\r\nexport interface ApiCallParams {\r\n    url: string;\r\n    method?: string;\r\n    body?: unknown;\r\n    signal?: AbortSignal;\r\n}\r\n\r\nexport async function apiCall<T = unknown>(\r\n    url: string,\r\n    method: string = \"GET\",\r\n    body?: unknown,\r\n    signal?: AbortSignal\r\n): Promise<T> {\r\n    const options: RequestInit = {\r\n        method,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        signal,\r\n    };\r\n    if (body) {\r\n        options.body = JSON.stringify(body);\r\n    }\r\n    try {\r\n        const response = await fetch(url, options);\r\n        if (!response.ok) {\r\n            let errorData: ApiErrorData = {};\r\n            try {\r\n                errorData = await response.json();\r\n            } catch {\r\n                // ignore parse error\r\n            }\r\n            throw new ApiError(response.status, errorData);\r\n        }\r\n        return await response.json();\r\n    } catch (error: unknown) {\r\n        if (error instanceof DOMException && error.name === \"AbortError\") {\r\n            throw new Error(\"요청이 취소되었습니다\");\r\n        }\r\n        handleApiError(error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function apiCallWithRetry<T = unknown>(\r\n    params: ApiCallParams & { retries?: number; initialDelayMs?: number },\r\n): Promise<T> {\r\n    const { retries = 2, initialDelayMs = 500, ...rest } = params;\r\n    return withRetry(\r\n        () => apiCall<T>(rest.url, rest.method, rest.body, rest.signal),\r\n        retries,\r\n        initialDelayMs,\r\n    );\r\n}\r\n\r\nexport function showLoading(elementId: string): void {\r\n    const el = document.getElementById(elementId);\r\n    if (!el) return;\r\n    el.innerHTML = '<div class=\"loading\"></div> 처리 중...';\r\n}\r\n\r\nexport function copyToClipboard(text: string, buttonEl: HTMLElement | null = null): void {\r\n    navigator.clipboard\r\n        .writeText(text)\r\n        .then(() => {\r\n            if (buttonEl) {\r\n                if (copyTimeouts.has(buttonEl)) {\r\n                    clearTimeout(copyTimeouts.get(buttonEl)!);\r\n                }\r\n                if (!buttonEl.dataset.originalText) {\r\n                    buttonEl.dataset.originalText = buttonEl.textContent || \"\";\r\n                }\r\n                buttonEl.textContent = \"✅ 복사됨\";\r\n                buttonEl.classList.add(\"copied\");\r\n                const timeout = setTimeout(() => {\r\n                    buttonEl.textContent = buttonEl.dataset.originalText || \"\";\r\n                    buttonEl.classList.remove(\"copied\");\r\n                    copyTimeouts.delete(buttonEl);\r\n                }, 1500);\r\n                copyTimeouts.set(buttonEl, timeout);\r\n            } else {\r\n                showToast(\"클립보드에 복사되었습니다!\", \"success\");\r\n            }\r\n        })\r\n        .catch((err) => showToast(\"복사 실패: \" + err.message, \"error\"));\r\n}\r\n\r\nexport interface SSEParseResult {\r\n    events: unknown[];\r\n    remainder: string;\r\n}\r\n\r\n// SSE 버퍼 파서 (불완전 청크 처리)\r\nexport function parseSSEBuffer(buffer: string): SSEParseResult {\r\n    const events: unknown[] = [];\r\n    let startIdx = 0;\r\n\r\n    while (true) {\r\n        const dataIdx = buffer.indexOf(\"data:\", startIdx);\r\n        if (dataIdx === -1) break;\r\n        const endIdx = buffer.indexOf(\"\\n\\n\", dataIdx);\r\n        if (endIdx === -1) {\r\n            return { events, remainder: buffer.slice(startIdx) };\r\n        }\r\n        const payload = buffer.slice(dataIdx + 5, endIdx).trim();\r\n        try {\r\n            events.push(JSON.parse(payload));\r\n        } catch (e) {\r\n            console.warn(\"Failed to parse SSE chunk:\", payload, e);\r\n        }\r\n        startIdx = endIdx + 2;\r\n    }\r\n    return { events, remainder: \"\" };\r\n}\r\n\r\n// 진행률 추정 헬퍼\r\nexport function showProgressWithEstimate(mode: \"batch\" | \"single\"): () => void {\r\n    const estimatedTime = mode === \"batch\" ? 90000 : 45000; // ms\r\n    const startTime = Date.now();\r\n    const progressInterval = setInterval(() => {\r\n        const elapsed = Date.now() - startTime;\r\n        const progress = Math.min(95, (elapsed / estimatedTime) * 100);\r\n        const bar = document.querySelector(\".progress-fill\") as HTMLElement;\r\n        if (bar) bar.style.width = progress + \"%\";\r\n    }, 200);\r\n    return () => clearInterval(progressInterval);\r\n}\r\n\r\nexport async function withRetry<T>(\r\n    fn: () => Promise<T>,\r\n    retries: number = 2,\r\n    initialDelayMs: number = 500\r\n): Promise<T> {\r\n    let attempt = 0;\r\n    let delay = initialDelayMs;\r\n    let lastError: unknown;\r\n    while (attempt <= retries) {\r\n        try {\r\n            return await fn();\r\n        } catch (err: unknown) {\r\n            lastError = err;\r\n            const retryable =\r\n                !err ||\r\n                (err instanceof ApiError && err.canRetry) ||\r\n                (typeof err === \"object\" &&\r\n                    err !== null &&\r\n                    \"status\" in err &&\r\n                    typeof (err as { status?: number }).status === \"number\" &&\r\n                    (err as { status: number }).status >= 500);\r\n            if (attempt === retries || !retryable) {\r\n                break;\r\n            }\r\n            await sleep(delay);\r\n            delay *= 2;\r\n            attempt += 1;\r\n        }\r\n    }\r\n    throw lastError;\r\n}\r\n","import { registerGlobalErrorHandlers } from \"./utils.js\";\n\n// Entry point: 페이지별 초기화\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    registerGlobalErrorHandlers();\n    const path = window.location.pathname;\n    if (path === \"/qa\") {\n        import(\"./qa.js\")\n            .then(({ initQA }) => initQA())\n            .catch((err) => console.error(\"QA 모듈 로드 실패:\", err));\n    } else if (path === \"/workspace\") {\n        import(\"./workspace.js\")\n            .then(({ initWorkspace }) => initWorkspace())\n            .catch((err) => console.error(\"Workspace 모듈 로드 실패:\", err));\n    } else if (path === \"/eval\") {\n        import(\"./eval.js\")\n            .then(({ initEval }) => initEval())\n            .catch((err) => console.error(\"Eval 모듈 로드 실패:\", err));\n    }\n});\n"],"file":"app.js"}